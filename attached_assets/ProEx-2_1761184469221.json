{
  "name": "ProEx",
  "nodes": [
    {
      "parameters": {
        "formTitle": "Documentação Cartas de Recomendação ",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Quadro Preenchido por Cliente",
              "fieldType": "file",
              "requiredField": true
            },
            {
              "fieldLabel": "Testimonial 1 (CV/LinkedIn Testimonial",
              "fieldType": "file",
              "requiredField": true
            },
            {
              "fieldLabel": "Testimonial 2 (CV/LinkedIn)",
              "fieldType": "file"
            },
            {
              "fieldLabel": "Testimonial 3 (CV/LinkedIn)",
              "fieldType": "file"
            },
            {
              "fieldLabel": "Testimonial 4 (CV/LinkedIn)",
              "fieldType": "file"
            },
            {
              "fieldLabel": "Testimonial 5 (CV/LinkedIn)",
              "fieldType": "file"
            },
            {
              "fieldLabel": "Estrategia Base",
              "fieldType": "file"
            },
            {
              "fieldLabel": "PDF do OneNote escolhido por cliente",
              "fieldType": "file"
            },
            {
              "fieldLabel": "Background (CV) Petitcionario",
              "fieldType": "file"
            },
            {
              "fieldLabel": "Email",
              "requiredField": true
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.3,
      "position": [
        -13280,
        1472
      ],
      "id": "a026775d-10b6-407a-abf8-ad290a72aebc",
      "name": "On form submission1",
      "webhookId": "4be81de9-97b3-46d0-b237-a79491eb3098",
      "alwaysOutputData": false,
      "retryOnFail": true,
      "notes": "If there is an error in the submission and you really want to continue, change the settings to \"On Error\" = \"Continue (using error output)\""
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "Quadro_Preenchido_por_Cliente",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -12368,
        1056
      ],
      "id": "d38313d2-e81b-4028-9e14-8a89a31b0488",
      "name": "Quadro Preenchido do Cliente1"
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "Testimonial_4__CV_LinkedIn_",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -12368,
        2288
      ],
      "id": "126f2998-8156-4c68-82b8-387eb3c45793",
      "name": "Resume 6"
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "Testimonial_1__CV_LinkedIn_Testimonial",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -12368,
        1936
      ],
      "id": "019d3cd2-8850-4acd-aabd-141cb2f561f7",
      "name": "Resume"
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "Testimonial_2__CV_LinkedIn_",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -12368,
        1760
      ],
      "id": "7f168535-a5e5-4537-925a-724d712cd3c8",
      "name": "Resume 2"
    },
    {
      "parameters": {
        "content": "# Extraindo Texto dos PDFs",
        "height": 1792,
        "width": 416,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -12512,
        912
      ],
      "id": "9a666046-d78b-4bb1-811d-ca7955460bc3",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# Role\n\nYou are an exceptional and infallible document editor for ProEx Venture. Your job is to take fragmented inputs from a client-completed recommendation form and seven attached documents: \n\n1. five recommender CVs with the unformatted text from the Quadro de Informacoes related to the person\n2. The petitioner’s CV, along with his strategy.\n3. The O*NET occupation page.\n\nThen produce perfectly structured, polished outputs in **Portuguese**, using **raw unformatted Markdown**. Tone: professional, Brazilian Portuguese, immigration-ready.Inputs (9 distinct source documents)\n\nEach block below will be populated by the upstream nodes. Every block will contain **plain text** from the corresponding file (already extracted via parser). \n\n**1) Quadro de Informações — Cartas de Recomendação (merged testimonies authored by the client)**\n\n\n{{ $('Quadro Preenchido do Cliente1').item.json.text }}\n\n**2) Testimonial__1___CV__LinkedIn__Testimonial (Recommender CV 1)**\n\n{{ $('Resume 2').item.json.text }}\n\n**3) Testimonial__2___CV__LinkedIn__ (Recommender CV 2)**\n\n{{ $('Resume').item.json.text }}\n\n**4) Testimonial__3___CV__LinkedIn__ (Recommender CV 3)**\n\n{{ $('Resume3').item.json.text }}\n\n**5) Testimonial__4___CV__LinkedIn__ (Recommender CV 4)**\n\n{{ $('Resume 6').item.json.text }}\n\n**6) Testimonial__5___CV__LinkedIn__ (Recommender CV 5)**\n\n{{ $('Resume 7').item.json.text }}\n\n\n**7) Background___CV___Peticionario (Applicant/Petitioner CV)**\n\n{{ $('Resume Cliente1').item.json.text }}\n\n**8) Estrategia__Base (Client Strategy document)**\n\n{{ $('Estrategia Base1').item.json.text }}\n\n**9) PDF__do__OneNote__escolhido__por__cliente (O*NET 17-3026 page)**\n\n{{ $('OneNote1').item.json.text }}\n\n## Assumptions\n1. Each text above is already the full extracted text of its source file (no binaries).\n2. The Quadro may include multiple testimonies concatenated; you must **separate them by recommender** and align each to the correct CV (1–5).\n3. If any input is missing or empty, please forget all of the rest and only output an error, along with its explanation\n\n## What to Produce (7 outputs, in this exact order)\n\nProduce a **single Markdown document** containing seven top-level sections:\n**Testimony 1 – [Name] (+ CV)**\n**Testimony 2 – [Name] (+ CV)**\n**Testimony 3 – [Name] (+ CV)**\n**Testimony 4 – [Name] (+ CV)**\n**Testimony 5 – [Name] (+ CV)**\n\n**Client Strategy & Applicant CV (Consolidated Summary)**\n\n**O*NET 17-3026 Alignment Extract**\n\n### Do **not** merge content across testimonies. \n\n### Do **not** insert strategy/O*NET material into any Testimony section. Keep strictly separated.Testimony Section Template (repeat for 1–5)\n\nFor each recommender (1→5), build a section using only:\n\nThe relevant slice of the **Quadro** that belongs to that recommender, and the corresponding **Recommender CV N** block.\n\n\n\n# Example Output (these are placeholders)\n\n\n\n### Testimony N – [Recommender Full Name]\n\n**Information**\n\nPosition: [Title] – [Company]\n\nPeriod of professional contact: [Start–End or Year–Year]\n\nRole of recommender at that time: [Role]\n\nApplicant’s role at that time: [Role/Title]\n\n**Text \n\n\n**Results Achieved**\n\n- [bullet]\n\n- [Bullet]\n\n- [Bullet]\n\n**CV**\n\n[Full CV of the recommender normalized into subsections. Include a LinkedIn URL as a plain Markdown link if present.]\n\n**CV – Normalization Rules**\n\n- Order: Profile/Summary → Experience → Education → Certifications → Skills → Languages → Publications (if any).\n\n- Standardize role lines: `Title, Company (MMM YYYY–MMM YYYY) – City, Country`.\n\n- Keep achievements as short bullets.\n\n- Translate terminology precisely; remove array artifacts (e.g., “Experience[0]”).\n\n- Omit lines you cannot substantiate; never invent dates, titles, or metrics.Client Strategy & Applicant CV (Consolidated Summary)\n\nUse **only** the Applicant/Petitioner CV and the Strategy document. Do not pull from testimonies here.\n\n# Client Strategy & Applicant CV (Consolidated Summary)\n\n## Applicant Snapshot (from Applicant CV)\n\n- Education: [degree, institution, year]\n\n- Core domains: [PLC/SCADA/IIoT, automation, standards…]\n\n- International experience: [countries/environments]\n\n- Quantified impact (only if present): [savings, uptime, throughput]\n\n## Strategy Summary (from Estrategia__Base)\n\n- Services offered: [consulting, training, maintenance planning, energy optimization…]\n\n- Target clients & use cases: [SMB/mid-market plants; retrofits; compliance upgrades…]\n\n- Compliance focus: [NR-10/NR-12, OSHA, ANSI/RIA, ISO/IEC…]\n\n- Differentiators: [standardization playbooks, replicable protocols, AaaS model, digital twins…]\n\n## Applicant CV – Structured Extract\n\n- Experience:\n\n- [Title], [Company] (MMM YYYY–MMM YYYY) – [City, Country]\n\\- \\[Achievement/Scope\\]\n- Education:\n\n- [Degree], [Institution] (YYYY–YYYY)\n\n- Certifications:\n\n- [List, one per line]\n\n- Skills:\n\n- [List, comma-separated]O*NET 17-3026 Alignment Extract\n\nUse **only** the O*NET page text. Summarize in immigration-ready language.\n\n# O*NET 17-3026 Alignment Extract\n\n## Representative Tasks (tailored to the applicant’s services)\n\n- [Task 1]\n\n- [Task 2]\n\n- [Task 3]\n\n- [Task 4]\n\n- [Task 5]\n\n- [Task 6]\n\n## Tools/Technologies Keywords\n\n- [e.g., PLCs (Rockwell, Siemens), SCADA/HMI, CAD, CMMS, sensors, robots, safety systems]\n\n## Work Activities & Skills (to reflect in letters)\n\n- [quality control analysis; systems evaluation; documentation; client training; cross-functional coordination; troubleshooting; data analysis…]\n\n\n# Hard Rules\nEntire output in **Potuguese** and **raw unformatted Markdown**.\n\n**No array artifacts** (e.g., “Results Achieved[0]”).\n\n**No cross-contamination** across testimonies.\n\n**No invention** of facts, roles, dates, or metrics; omit unknown lines. If there are too many unknown lines, output an error and explain it. \n\n**Information block** must use the exact four lines shown.\n\n**Results Achieved**: 3–5 bullets where possible; each must be supported by the testimony or the CV.\n\nStrategy and O*NET content must **not** appear inside any Testimony section.\n\nAlways generate all seven top-level sections in the specified order.\n\n## Separation & Mapping Guidance\n\nMap each recommender in the Quadro to **the corresponding CV** by name and/or order (Testimonial 1→5).\n\nIf the Quadro contains testimonies without perfect names, infer mapping by contextual clues (company/title). \n\nIf still uncertain, keep the section but **omit** any disputed line.\n\nFor missing CV text: include the Testimony section (with translated testimony) and add a **CV** block with only the fields available.\n\n# only output the documents we've discussed. Do not output placeholders or templates. Only the filled out documents. \n\n# it is vital for my carreer that you do not make any mistakes and follow the directions. \n\n\nCRITICAL OUTPUT REQUIREMENT:\nYou MUST output ONLY valid JSON. No markdown headers, no code fences, no explanations.\n\nStart your response with { and end with }\n\nOUTPUT FORMAT:\nYou MUST output valid JSON with these fields:\n- petitioner (object)\n- strategy (object)\n- onet (object)\n- testimonies (array of exactly 5 objects)\n\nStart with { and end with }\nNo markdown, no code fences, no explanations.\n\n\nDO NOT use markdown headers like # or **.\nDO NOT wrap in ```json code fences.\nOutput ONLY the raw JSON object.\n\n# IF there isn't a onenote pdf, just keep going without it and output null data for the onenote part. \n",
        "hasOutputParser": true,
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -11216,
        1632
      ],
      "id": "f1403b4e-4f1b-4589-9d8f-7fbf8a7f0661",
      "name": "Limpando e Organizando Inputs1",
      "retryOnFail": true
    },
    {
      "parameters": {
        "content": "# Primeira Organização \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Output ideal:\n\n## Testimony 1 – John Doe\n\n### Information\n\nPosition: Maintenance Manager – Bracell  \nPeriod of professional contact: 2009–2021  \nRole of recommender at that time: Maintenance Manager  \nApplicant’s role at that time: Electrical Engineer  \n\n### Text\n\nIn 2017 we co-led a project at Kimberly Clark Brazil aimed at increasing efficiency in the manufacturing process. The project was structured using Six Sigma methodology, which reduced identified inefficiencies and implemented new standardized procedures.  \n\n### Results Achieved\n\n- Ensured high reliability in product inspection, creating a more robust and standardized process  \n- Saved over $700,000 annually by reducing waste and improving process capability  \n- Established standardized electronic vision systems, guaranteeing consistent quality across production lines  \n\n### CV\n\n[LinkedIn – John Doe](https://www.linkedin.com/in/johndoe)  \nEducation: MBA in Business Management – XYZ University  \nExperience:  \n- Maintenance Manager, Bracell (2009–2021)  \n- Senior Engineer, Kimberly Clark (2005–2009)  \nCertifications: Lean Six Sigma Black Belt, TPM Implementation Specialist  \nLanguages: English (Fluent), Portuguese (Native)  \n\n\n",
        "height": 1792,
        "width": 480,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -11424,
        1456
      ],
      "id": "d974442b-9af7-4f9b-a7d2-ebe990b399a0",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "Testimonial_5__CV_LinkedIn_",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -12368,
        2464
      ],
      "id": "3363bd9d-c782-4afe-8365-a03ad19df16d",
      "name": "Resume 7"
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "=Background__CV__Petitcionario",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -12368,
        1248
      ],
      "id": "259e9577-4e24-45e3-94b8-5fab87bec82e",
      "name": "Resume Cliente1"
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "Estrategia_Base",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -12368,
        1408
      ],
      "id": "23610030-9346-437f-a0a0-7e880c5ea9d5",
      "name": "Estrategia Base1"
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "PDF_do_OneNote_escolhido_por_cliente",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -12368,
        1584
      ],
      "id": "91173b77-4ecc-4667-977e-386dc82d4fbf",
      "name": "OneNote1",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "975b7031-a10f-4fe5-98c7-d3557503f4e9",
              "leftValue": "={{ $json.message.content.action }}",
              "rightValue": "PROCEED",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -10048,
        1808
      ],
      "id": "0cc30f00-06be-4e16-b482-574dd05b8c39",
      "name": "If1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "driveId": "=",
        "folderId": "=",
        "title": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Title', ``, 'string') }}"
      },
      "type": "n8n-nodes-base.googleDocsTool",
      "typeVersion": 2,
      "position": [
        -10224,
        2352
      ],
      "id": "057c407d-9a63-46ef-916d-c50dfc6c0e63",
      "name": "Create a document in Google Docs1",
      "credentials": {
        "googleApi": {
          "id": "JAomXUQlUYsa472G",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "rafa",
        "toEmail": "paulo@proexventure.com",
        "subject": "Baba",
        "html": "bababa",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSendTool",
      "typeVersion": 2.1,
      "position": [
        -10048,
        2352
      ],
      "id": "01c46bff-b617-464d-a555-aa707cd9e09c",
      "name": "Send email in Send Email1",
      "webhookId": "5be0d353-a2c3-4726-9afe-4611e8619148",
      "credentials": {
        "smtp": {
          "id": "KompgYs6hULIuobD",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "GPT-4O"
        },
        "messages": {
          "values": [
            {
              "content": "You are an EB-2 NIW QA reviewer. Analyze the testimony package below.\n\nChecks to consider:\n- Insufficient or incomplete inputs\n- Missing information in required columns/fields\n- Exaggerated or unrealistic numbers/data\n- Stories incompatible with the CVs\n- Structural/formatting problems\n\nGenerate your answer in **HTML format** so it can be sent by email.\n\nStructure:\n<h2>Summary Decision</h2>\n<p>NEEDS_FIX – The document has issues that must be addressed before proceeding.</p>\n\n<h3>Problems Found</h3>\n<ul>\n  <li>Missing details in the recommender’s role description.</li>\n  <li>Unrealistic financial savings figures reported.</li>\n  <li>One testimony timeline does not align with the applicant’s CV.</li>\n</ul>\n\n<h3>Suggested Fixes</h3>\n<ul>\n  <li>Add clear role descriptions for each recommender.</li>\n  <li>Revise financial impact with verifiable and conservative estimates.</li>\n  <li>Correct the dates so they match the CV entries.</li>\n</ul>\n\n<h3>Global Notes</h3>\n<p>This package has strong technical content but requires alignment with the CV and realistic\nquantitative data before it is ready for USCIS submission.</p>\n\n\nRules:\n- If no issues → still return the same structure, but say \"No problems found. Safe to proceed.\"\n- Keep HTML simple (no CSS, only headings, lists, and paragraphs).\n"
            }
          ]
        },
        "simplify": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -10128,
        2128
      ],
      "id": "e103bfe3-8e0f-4bb8-ad2f-36f4bfb0fcd8",
      "name": "Reports1",
      "credentials": {
        "openAiApi": {
          "id": "ak04OEEu6FVkE8WI",
          "name": "API ProEx"
        }
      }
    },
    {
      "parameters": {
        "errorMessage": "An error occurred!"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -9744,
        2128
      ],
      "id": "11691fc6-6d28-4acb-8bde-a83e3cb416a1",
      "name": "Stop and Error1"
    },
    {
      "parameters": {
        "content": "# Proceder ou gerar relatorio de erros? ",
        "height": 880,
        "width": 896,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -10496,
        1680
      ],
      "id": "4701a805-e3a6-4ded-8dbc-9c31f1f0b8d4",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -11344,
        1840
      ],
      "id": "98f73842-5846-44bc-a17f-2f0258d5cd9f",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"petitioner\": {\n    \"name\": \"John Doe\",\n    \"education\": [],\n    \"experience\": []\n  },\n  \"strategy\": {\n    \"services_offered\": [],\n    \"target_clients\": \"\"\n  },\n  \"onet\": {\n    \"representative_tasks\": [],\n    \"tools_and_technologies\": [],\n    \"work_activities_and_skills\": []\n  },\n  \"testimonies\": [\n    {\n      \"testimony_id\": 1,\n      \"recommender_name\": \"\",\n      \"recommender_company\": \"\",\n      \"recommender_role\": \"\",\n      \"collaboration_period\": \"\",\n      \"applicant_role\": \"\",\n      \"testimony_text\": \"\",\n      \"key_achievements\": []\n    },\n    {\n      \"testimony_id\": 2,\n      \"recommender_name\": \"\",\n      \"recommender_company\": \"\",\n      \"recommender_role\": \"\",\n      \"collaboration_period\": \"\",\n      \"applicant_role\": \"\",\n      \"testimony_text\": \"\",\n      \"key_achievements\": []\n    },\n    {\n      \"testimony_id\": 3,\n      \"recommender_name\": \"\",\n      \"recommender_company\": \"\",\n      \"recommender_role\": \"\",\n      \"collaboration_period\": \"\",\n      \"applicant_role\": \"\",\n      \"testimony_text\": \"\",\n      \"key_achievements\": []\n    },\n    {\n      \"testimony_id\": 4,\n      \"recommender_name\": \"\",\n      \"recommender_company\": \"\",\n      \"recommender_role\": \"\",\n      \"collaboration_period\": \"\",\n      \"applicant_role\": \"\",\n      \"testimony_text\": \"\",\n      \"key_achievements\": []\n    },\n    {\n      \"testimony_id\": 5,\n      \"recommender_name\": \"\",\n      \"recommender_company\": \"\",\n      \"recommender_role\": \"\",\n      \"collaboration_period\": \"\",\n      \"applicant_role\": \"\",\n      \"testimony_text\": \"\",\n      \"key_achievements\": []\n    }\n  ]\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -11104,
        1824
      ],
      "id": "6143337a-3e56-46dd-a6ae-2e38f04754af",
      "name": "Structured Output Parser1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -11088,
        1984
      ],
      "id": "7b7d0fb6-a051-49ba-ace4-29b6d58403c9",
      "name": "Google Gemini Chat Model3",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Purpose\nQueries our OpenAI Vector Store for compliance phrasing and “red-flag” terms to pre-seed the DraftGenerator and ComplianceScanner.\nWhen this node runs\nBefore any drafting, to fetch the latest “safe wording / avoid wording” snippets.\nRequest\nPOST https://api.openai.com/v1/vector_stores/{VECTOR_STORE_ID}/search\nBody:\n{ \"query\": \"NIW letters compliance phrasing and forbidden terms for recommendation letters\" }\nResponse handling\nConcatenate the top results’ text into compliance_hints (string).\nExpose compliance_hints to the downstream DraftGenerator and ComplianceScanner.\nNotes\nDo not send max_results (unsupported).\nIf the store returns nothing, set compliance_hints=\"\" and let ComplianceScanner fall back to defaults.",
        "method": "POST",
        "url": "https://api.openai.com/v1/vector_stores/vs_68d5cdc6ed788191aac4180dbb63e2d3/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{ \"query\" : \"Summarize EB2-NIW compliance regarding letters of testimony language and wording.\" }",
        "options": {
          "response": {
            "response": {
              "fullResponse": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Include_Response_Headers_and_Status', ``, 'boolean') }}",
              "neverError": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Never_Error', ``, 'boolean') }}"
            }
          }
        },
        "optimizeResponse": true
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -9216,
        544
      ],
      "id": "3c9381bb-8aae-41d4-99d2-ee0ea84169ca",
      "name": "VECTOR STORE",
      "credentials": {
        "httpBearerAuth": {
          "id": "iIaPcX8szhdxnOLW",
          "name": "Bearer Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE  \nYou are `Block1_PROMPT`, a world-class letter of recommendation writer for EB2-NIW.\n\n**YOUR WRITING STYLE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[1] }}\n\n---\n\n# Instructions\nThis prompt focuses on establishing the recommender’s credibility and introducing the applicant’s competencies in strategic leadership and management. The voice must be 100% in the first person (the recommender speaking).\n\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].key_achievements }}\n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 1,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 1: LEADERSHIP & CREDIBILITY INTRODUCTION\n\nThe draft should be **300-600 words**.\n\n## 1. Establish Authority\n\n* Introduce yourself in first person, emphasizing your professional credibility, expertise, and organizational authority.\n* Apply (apply, don't write that the petitinoer has logical inference, you apply logical inference to expand the testimony's letter) **Logical Inference**: make a clear reasoning chain that explains *why your perspective as a recommender is authoritative*.\n\n## 2. Contextualize the Relationship\n\n* Describe how you know the applicant, the scope of collaboration, and the relevance of their role.\n* Apply **Technical Inference** (apply, don't write that the petitinoer has technical inference, you apply techincal inference to expand the testimony's letter) show how your professional background equips you to evaluate the applicant’s leadership and management skills in a technical or organizational setting.\n\n## 3. Frame the Applicant as a Leader\n\n* Present the applicant as a strategic leader and manager, not just an executor.\n* Highlight early indicators of problem-solving, decision-making, and vision.\n* Apply **Causal Nexus** (apply, don't write that the petitinoer has causal nexus, you apply causal nexus to expand the testimony's letter): draw direct cause-and-effect links between the applicant’s leadership actions and measurable organizational outcomes (team growth, efficiency gains, successful project delivery, etc.).\n\n## 4. Closing\n\n* Reinforce that the applicant has consistently demonstrated these qualities across contexts.\n* Position them as someone whose leadership generates broad, scalable impact.\n\n---\n\n# Notes and Rules\n\n* Voice: 100% from the recommender (first person).\n* Content: Present the recommender’s authority, contextualize the professional relationship, and frame the applicant as a leader/manager, not a mere executor.\n* Restrictions:\n\n  * Do not use vague adjectives.\n  * Do not mention immigration/visa (USCIS, NIW, EB-2, green card, etc.).\n  * Do not include farewell salutations.\n* **Inference Framework**:\n\n  * **Logical Inference** must appear in how the recommender justifies their credibility.\n  * **Technical Inference** must appear in how the recommender situates the applicant’s competencies.\n  * **Causal Nexus** must appear in how the recommender connects the applicant’s leadership actions to measurable organizational outcomes.\n* Do not necessarily use those words in the draft\n* Use **300–600 words** for the introduction.\n* Follow guidance from your **VectorSTORE7** tool.\n* Do not use placeholders. If no input is available, pause the workflow.\n\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos \"imigracao\", \"EB2-NIW\", \"peticionario\"\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -8272,
        304
      ],
      "id": "d4800a9f-4eb2-4eb1-8e00-7426f0563004",
      "name": "BLOCO",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE\nYou are `Block3_PROMPT`\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].tone_instructions }}\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 3,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 3: EMPIRICAL VALIDATION OF RESULTS\n\nThe draft should be **400–600 words** (~20–30 Markdown lines).\n\n## Evidence Presentation\n\n* Narrate in first person how you directly measured or experienced the outcomes.\n* Distinguish between **quantitative data** (KPIs, before/after metrics, % improvements, cost/time savings) and **qualitative evidence** (feedback from teams, consistency, reliability).\n* Explicitly apply the **inference framework**:\n\n  * **Logical Inference** → show reasoning that links the observed data to broader conclusions.\n  * **Technical Inference** → explain how technical evidence or data analysis validates the applicant’s results.\n  * **Causal Nexus** → demonstrate direct cause-and-effect between the applicant’s actions and the achieved outcomes.\n* Then provide a **bullet list of 4–6 items** that summarize the strongest empirical results, each in the format:\n  `- By [specific action], [Applicant] achieved [numeric/qualitative outcome] → leading to [impact].`\n\n---\n\n# RULES\n\n* **Voice**: Always first person, recommender speaking.\n* **Length**: 400–600 words (~20–30 Markdown lines).\n* **Focus**: Results only — do not drift into market/impact arguments.\n* **Evidence**: Must include at least 3 quantitative metrics and 1–2 qualitative observations.\n* **Inference Discipline**:\n\n  * Logical Inference must appear in framing the reasoning chain behind results.\n  * Technical Inference must appear in the explanation of data/metrics.\n  * Causal Nexus must appear in linking the applicant’s actions to outcomes.\n* Do not necessarily use those words in the draft\n\n\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if they appear in inputs.\n* **Style**: Professional, precise, executive-level; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n\n\n```\n\n```\n# note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n\n\n\n# O output inteiro tem que ser em portugues\n\n\n# Retire absolutamente todos os termos \"imigracao\", \"EB2-NIW\", \"peticionario\"\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -7584,
        304
      ],
      "id": "a732ac81-f2b5-4413-95a5-eb167875567b",
      "name": "BLOCO5",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Purpose\nQueries our OpenAI Vector Store for compliance phrasing and “red-flag” terms to pre-seed the DraftGenerator and ComplianceScanner.\nWhen this node runs\nBefore any drafting, to fetch the latest “safe wording / avoid wording” snippets.\nRequest\nPOST https://api.openai.com/v1/vector_stores/{VECTOR_STORE_ID}/search\nBody:\n{ \"query\": \"NIW letters compliance phrasing and forbidden terms for recommendation letters\" }\nResponse handling\nConcatenate the top results’ text into compliance_hints (string).\nExpose compliance_hints to the downstream DraftGenerator and ComplianceScanner.\nNotes\nDo not send max_results (unsupported).\nIf the store returns nothing, set compliance_hints=\"\" and let ComplianceScanner fall back to defaults.",
        "method": "POST",
        "url": "https://api.openai.com/v1/vector_stores/vs_68d5cdc6ed788191aac4180dbb63e2d3/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{ \"query\": \"Summarize EB-2 NIW requirements\" }\n",
        "options": {
          "response": {
            "response": {
              "fullResponse": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Include_Response_Headers_and_Status', ``, 'boolean') }}",
              "neverError": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Never_Error', ``, 'boolean') }}"
            }
          }
        },
        "optimizeResponse": true
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -6336,
        480
      ],
      "id": "4ac224a8-de2c-4dcf-89c1-9f2ec853985b",
      "name": "VECTOR STORE7",
      "credentials": {
        "httpBearerAuth": {
          "id": "iIaPcX8szhdxnOLW",
          "name": "Bearer Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "URL/HTML to PDF",
        "convertType": "htmlToPDF",
        "html": "={{ $('Message a model3').item.json.output }}",
        "advancedOptions": {}
      },
      "type": "n8n-nodes-pdfco.PDFco Api",
      "typeVersion": 1,
      "position": [
        5056,
        208
      ],
      "id": "ea8dfc5b-b465-4955-be0b-23fbb6ee7976",
      "name": "PDFco Api5",
      "credentials": {
        "pdfcoApi": {
          "id": "JlTTI5hYRnMh18Q2",
          "name": "PDF.co account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE  \nYou are `Block1_PROMPT`, a world-class letter of recommendation writer for EB2-NIW.\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_instructions }}\n\nGenerate a Markdown draft for Block 1 that matches this specific voice and style.\n\n---\n\n# Instructions\nThis prompt focuses on establishing the recommender’s credibility and introducing the applicant’s competencies in strategic leadership and management. The voice must be 100% in the first person (the recommender speaking).\n\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 1,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 1: LEADERSHIP & CREDIBILITY INTRODUCTION\n\nThe draft should be **300-600 words**.\n\n## 1. Establish Authority\n\n* Introduce yourself in first person, emphasizing your professional credibility, expertise, and organizational authority.\n* Apply (apply, don't write that the petitinoer has logical inference, you apply logical inference to expand the testimony's letter) **Logical Inference**: make a clear reasoning chain that explains *why your perspective as a recommender is authoritative*.\n\n## 2. Contextualize the Relationship\n\n* Describe how you know the applicant, the scope of collaboration, and the relevance of their role.\n* Apply **Technical Inference** (apply, don't write that the petitinoer has technical inference, you apply techincal inference to expand the testimony's letter) show how your professional background equips you to evaluate the applicant’s leadership and management skills in a technical or organizational setting.\n\n## 3. Frame the Applicant as a Leader\n\n* Present the applicant as a strategic leader and manager, not just an executor.\n* Highlight early indicators of problem-solving, decision-making, and vision.\n* Apply **Causal Nexus** (apply, don't write that the petitinoer has causal nexus, you apply causal nexus to expand the testimony's letter): draw direct cause-and-effect links between the applicant’s leadership actions and measurable organizational outcomes (team growth, efficiency gains, successful project delivery, etc.).\n\n## 4. Closing\n\n* Reinforce that the applicant has consistently demonstrated these qualities across contexts.\n* Position them as someone whose leadership generates broad, scalable impact.\n\n---\n\n# Notes and Rules\n\n* Voice: 100% from the recommender (first person).\n* Content: Present the recommender’s authority, contextualize the professional relationship, and frame the applicant as a leader/manager, not a mere executor.\n* Restrictions:\n\n  * Do not use vague adjectives.\n  * Do not mention immigration/visa (USCIS, NIW, EB-2, green card, etc.).\n  * Do not include farewell salutations.\n* **Inference Framework**:\n\n  * **Logical Inference** must appear in how the recommender justifies their credibility.\n  * **Technical Inference** must appear in how the recommender situates the applicant’s competencies.\n  * **Causal Nexus** must appear in how the recommender connects the applicant’s leadership actions to measurable organizational outcomes.\n* Do not necessarily use those words in the draft\n* Use **300–600 words** for the introduction.\n* Follow guidance from your **VectorSTORE7** tool.\n* Do not use placeholders. If no input is available, pause the workflow.\n\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos \"imigracao\", \"EB2-NIW\", \"peticionario\"\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n\n"
            }
          ]
        },
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -10992,
        304
      ],
      "id": "f71c86b8-da54-4360-88be-0e84c5243932",
      "name": "BLOCO1.1",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=\nYou are `Block4_PROMPT`.  \nYour mission is to generate **Block 4** of a recommendation letter, based on one testimony and supporting documents.  \nThis block must be written entirely in the **first person** (the recommender speaking), with a **formal, technical, and market-aware tone**.\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_instructions }}\n\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n\n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 4,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 4: MARKET & STRATEGIC RELEVANCE\n\nThe draft should be **350–600 words**.\n\n## 1. Transition (Logical Inference)\n\n* Open by explicitly linking Block 3’s evidence to a larger reasoning chain.\n* Use **Logical Inference** to show that the results already validated are not isolated events, but proof of a replicable, strategic model.\n* Example: “The results I described earlier are not isolated technical gains; they demonstrate a scalable model with broader implications.”\n\n## 2. Market Relevance (Technical Inference)\n\n* Show how the validated results translate into **competitive advantages** (efficiency, safety, cost savings, reliability).\n* Explain why these outcomes matter for the wider industry or sector.\n* Apply **Technical Inference**: connect specific technical outcomes (KPIs, automation methods, sustainability practices) to market needs and industry benchmarks.\n\n## 3. Scalability & Replication (Causal Nexus)\n\n* Demonstrate how the applicant’s approach can be replicated or standardized across different plants, companies, or sectors.\n* Use **Causal Nexus**: establish direct cause-and-effect between the applicant’s innovations and their ability to scale across markets (e.g., training frameworks, tech transfer, industry adoption).\n\n## 4. Closing (Logical + Strategic Positioning)\n\n* Conclude this block by positioning the applicant’s competencies as not just solving one project, but **creating transferable value** that aligns with their proposed endeavor/strategy.\n* Reinforce that their results → impact → strategic scalability chain is clear and sustainable.\n\n---\n\n# RULES\n\n* **Voice**: Always first person, recommender speaking.\n* **Length**: 350–600 words.\n* **Inference Discipline**:\n\n  * Logical Inference → used to transition Block 3 evidence into Block 4 reasoning.\n  * Technical Inference → used to link technical results to broader industry/market relevance.\n  * Causal Nexus → used to connect applicant’s actions directly to scalable, replicable outcomes.\n* Do not use those words in the draft\n\n* **Focus**: Strategic/market relevance, scalability, and replicability — not raw technical details.\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if present in inputs.\n* **Style**: Professional, strategic, industry-focused; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n\n### note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -9920,
        304
      ],
      "id": "104794ba-5ec0-468b-b1b0-b41da72da1cf",
      "name": "BLOCO4.1",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=````markdown\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_instructions }}\n## 📌 BLOCK5_PROMPT — Adaptability & Conclusion\n\n# ROLE\nYou are `Block5_PROMPT`.  \nYour mission is to generate **Block 5**, the final section of a recommendation letter, based on one testimony and supporting documents.  \nThe style must be entirely in the **first person** (the recommender’s voice), formal and conclusive.\n\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 5,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 5: ADAPTABILITY & CONCLUSION\n\nThe draft should be **300–600 words**.\n\n## 1. Transition (Logical Inference)\n\n* Open by linking to the previous blocks: show how the applicant’s proven results and market impact also demonstrate **adaptability and learning**.\n* Apply **Logical Inference**: explicitly reason that adaptability is a natural extension of the results described in Block 3 (evidence) and Block 4 (market impact).\n* Example: “Beyond the outcomes I have described, what struck me most was [Applicant’s] ability to learn, adapt, and refine methods in real time.”\n\n## 2. Adaptability & Learning (Technical Inference)\n\n* Narrate how the applicant adapted strategies to unforeseen challenges or evolving conditions.\n* Highlight moments of learning, resilience, and growth you personally witnessed.\n* Apply **Technical Inference**: connect adaptability to technical decisions (e.g., pivoting methods, integrating new tools, reconfiguring systems).\n* Use at least one **concrete example** from the testimony.\n\n## 3. Strong Closing Endorsement (Causal Nexus)\n\n* Frame the applicant as a rare professional: combining technical depth, leadership, innovation, and adaptability.\n* Apply **Causal Nexus**: make the cause-and-effect link between the applicant’s adaptability and the sustained success of their projects.\n* End with a definitive recommendation, leaving no ambiguity about your conviction.\n* Example: “Based on my direct experience, I can state without hesitation that [Applicant] is among the most capable professionals I have worked with, and I strongly endorse his future endeavors.”\n\n## 4. Signature Block\n\n* Close with a professional sign-off, including:\n\n```\n**{Recommender Full Name}**  \n**{Title}, {Organization}**  \n{Email | Phone | LinkedIn if available}  \n```\n\n---\n\n# RULES\n\n* **Voice**: 100% first person, recommender speaking.\n* **Length**: 300–600 words.\n* **Inference Discipline**:\n\n  * Logical Inference → connect adaptability to prior results and impact.\n  * Technical Inference → explain how adaptability manifested in technical/strategic pivots.\n  * Causal Nexus → show how adaptability directly produced sustained outcomes.\n* Do not  use those exact words in the draft\n\n* **Focus**: Adaptability, learning, resilience + final endorsement.\n* **Compliance**:\n\nNão mencione “imigração”, “visto”, “EB-2”, “NIW”, “oficial”, “interesse nacional”, “USCIS”, “green card” ou “residência”.\n  * Replace with neutral equivalents if they appear in inputs.\n* **Style**: Professional, conclusive, evidence-based. Avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n\n```\n```\n### note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n\n\n# O output inteiro tem que ser em portugues\n\n# Não mencione “imigração”, “visto”, “EB-2”, “NIW”, “oficial”, “interesse nacional”, “USCIS”, “green card” ou “residência”.\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -9600,
        304
      ],
      "id": "347fc805-1c8d-4c70-a6e4-530071df8b30",
      "name": "BLOCO5.1",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE\nYou are `Block3_PROMPT`\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_instructions }}\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n### Block2 Output\n{{ $json.candidates[0].content.parts[0].text }}\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 3,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 3: EMPIRICAL VALIDATION OF RESULTS\n\nThe draft should be **400–600 words** (~20–30 Markdown lines).\n\n## Evidence Presentation\n\n* Narrate in first person how you directly measured or experienced the outcomes.\n* Distinguish between **quantitative data** (KPIs, before/after metrics, % improvements, cost/time savings) and **qualitative evidence** (feedback from teams, consistency, reliability).\n* Explicitly apply the **inference framework**:\n\n  * **Logical Inference** → show reasoning that links the observed data to broader conclusions.\n  * **Technical Inference** → explain how technical evidence or data analysis validates the applicant’s results.\n  * **Causal Nexus** → demonstrate direct cause-and-effect between the applicant’s actions and the achieved outcomes.\n* Then provide a **bullet list of 4–6 items** that summarize the strongest empirical results, each in the format:\n  `- By [specific action], [Applicant] achieved [numeric/qualitative outcome] → leading to [impact].`\n\n---\n\n# RULES\n\n* **Voice**: Always first person, recommender speaking.\n* **Length**: 400–600 words (~20–30 Markdown lines).\n* **Focus**: Results only — do not drift into market/impact arguments.\n* **Evidence**: Must include at least 3 quantitative metrics and 1–2 qualitative observations.\n* **Inference Discipline**:\n\n  * Logical Inference must appear in framing the reasoning chain behind results.\n  * Technical Inference must appear in the explanation of data/metrics.\n  * Causal Nexus must appear in linking the applicant’s actions to outcomes.\n* Do not necessarily use those words in the draft\n\n\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if they appear in inputs.\n* **Style**: Professional, precise, executive-level; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n\n\n```\n\n```\n# note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n\n\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos \"imigracao\", \"EB2-NIW\", \"peticionario\"\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -10272,
        304
      ],
      "id": "67363547-9db4-419a-84e9-62ac938b74aa",
      "name": "BLOC",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "operation": "URL/HTML to PDF",
        "convertType": "htmlToPDF",
        "html": "={{ $('Message a model4').item.json.output }}",
        "advancedOptions": {}
      },
      "type": "n8n-nodes-pdfco.PDFco Api",
      "typeVersion": 1,
      "position": [
        5296,
        240
      ],
      "id": "95cec67d-024b-4059-a595-ec65adf586f6",
      "name": "PDFco Api6",
      "credentials": {
        "pdfcoApi": {
          "id": "JlTTI5hYRnMh18Q2",
          "name": "PDF.co account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Purpose\nQueries our OpenAI Vector Store for compliance phrasing and “red-flag” terms to pre-seed the DraftGenerator and ComplianceScanner.\nWhen this node runs\nBefore any drafting, to fetch the latest “safe wording / avoid wording” snippets.\nRequest\nPOST https://api.openai.com/v1/vector_stores/{VECTOR_STORE_ID}/search\nBody:\n{ \"query\": \"NIW letters compliance phrasing and forbidden terms for recommendation letters\" }\nResponse handling\nConcatenate the top results’ text into compliance_hints (string).\nExpose compliance_hints to the downstream DraftGenerator and ComplianceScanner.\nNotes\nDo not send max_results (unsupported).\nIf the store returns nothing, set compliance_hints=\"\" and let ComplianceScanner fall back to defaults.",
        "method": "POST",
        "url": "https://api.openai.com/v1/vector_stores/vs_68d5cdc6ed788191aac4180dbb63e2d3/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{ \"query\": \"Summarize EB-2 NIW requirements\" }\n",
        "options": {
          "response": {
            "response": {
              "fullResponse": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Include_Response_Headers_and_Status', ``, 'boolean') }}",
              "neverError": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Never_Error', ``, 'boolean') }}"
            }
          }
        },
        "optimizeResponse": true
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -4800,
        608
      ],
      "id": "8d78cd7d-e02e-47a5-be2e-4cca250c04d5",
      "name": "VECTOR STORE9",
      "credentials": {
        "httpBearerAuth": {
          "id": "iIaPcX8szhdxnOLW",
          "name": "Bearer Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro-preview-06-05",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro-preview-06-05"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE  \nYou are `Block1_PROMPT`, a world-class letter of recommendation writer for EB2-NIW.\n\n**YOUR UNIQUE VOICE FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].tone_instructions }}\n\n**YOUR WRITING STYLE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].paragraph_density_rule }}\n\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].tone_variable }}\n---\n\n# Instructions\nThis prompt focuses on establishing the recommender’s credibility and introducing the applicant’s competencies in strategic leadership and management. The voice must be 100% in the first person (the recommender speaking).\n\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].key_achievements }}\n\n# Block 1 from other Testimonies\n\n{{ $('BLOCO').item.json.candidates[0].content.parts[0].text }}\n\n\n{{ $('BLOCO1.1').item.json.content.parts[0].text }}\n\n### Note \nPlease do not generate a block identical to the blocks for the last testimonials. \n---\n\n\n\n\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 1,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 1: LEADERSHIP & CREDIBILITY INTRODUCTION\n\nThe draft should be **300-600 words**.\n\n## 1. Establish Authority\n\n* Introduce yourself in first person, emphasizing your professional credibility, expertise, and organizational authority.\n* Apply **Logical Inference**: make a clear reasoning chain that explains *why your perspective as a recommender is authoritative*.\n\n## 2. Contextualize the Relationship\n\n* Describe how you know the applicant, the scope of collaboration, and the relevance of their role.\n* Apply **Technical Inference**: show how your professional background equips you to evaluate the applicant’s leadership and management skills in a technical or organizational setting.\n\n## 3. Frame the Applicant as a Leader\n\n* Present the applicant as a strategic leader and manager, not just an executor.\n* Highlight early indicators of problem-solving, decision-making, and vision.\n* Apply **Causal Nexus**: draw direct cause-and-effect links between the applicant’s leadership actions and measurable organizational outcomes (team growth, efficiency gains, successful project delivery, etc.).\n\n## 4. Closing\n\n* Reinforce that the applicant has consistently demonstrated these qualities across contexts.\n* Position them as someone whose leadership generates broad, scalable impact.\n\n---\n\n# Notes and Rules\n\n* Voice: 100% from the recommender (first person).\n* Content: Present the recommender’s authority, contextualize the professional relationship, and frame the applicant as a leader/manager, not a mere executor.\n* Restrictions:\n\n  * Do not use vague adjectives.\n  * Do not mention immigration/visa (USCIS, NIW, EB-2, green card, etc.).\n  * Do not include farewell salutations.\n* **Inference Framework**:\n\n  * **Logical Inference** must appear in how the recommender justifies their credibility.\n  * **Technical Inference** must appear in how the recommender situates the applicant’s competencies.\n  * **Causal Nexus** must appear in how the recommender connects the applicant’s leadership actions to measurable organizational outcomes.\n* Do not necessarily use those exact words in the draft\n\n* Use **300–600 words** for the introduction.\n* Do not use placeholders. If no input is available, pause the workflow.\n\n\n\n# O output inteiro tem que ser em portugues\n\n# Não mencione “imigração”, “visto”, “EB-2”, “NIW”, “oficial”, “interesse nacional”, “USCIS”, “green card” ou “residência”.\n\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -5008,
        304
      ],
      "id": "969a79a4-f280-40ed-9dc2-49627c7f3c1c",
      "name": "BLO",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=\n## 📌 BLOCK2_PROMPT — Technical Innovation & Problem-Solving\n\n# ROLE\nYou are `Block2_PROMPT`.  \nYour mission is to generate **Block 2** of a recommendation letter, based on one testimony and the supporting documents.  \nThe style must be 100% in the first person (the recommender speaking), with a **technical, precise, and evidence-driven tone**.\n\n---\n\n# Inputs\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].key_achievements }}\n\n## Block1 Output\n{{ $json.content.parts[0].text }}\n\n## Other Block 2 Outputs from other testimonials\n{{ $('BLOCO6').item.json.message.content }}\n\n{{ $('BLOCO2.1').item.json.message.content }}\n\n### Follow guidance from VectorDB\n\n### Note \nPlease do not generate a block identical to the blocks for the last testimonials. \n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 2,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 2: TECHNICAL INNOVATION & PROBLEM-SOLVING\n\nThe draft should be **300-600 words**\n\n## 1. Setup\n\n* Introduce yourself briefly in first person (role, organization, authority).\n* Define the **central technical problem** the applicant addressed (use specific terms, no vague phrasing).\n* Explicitly show **Logical Inference**: describe how the problem was identified, what assumptions were tested, and how reasoning led to defining the challenge.\n\n## 2. Innovation & Solution\n\n* Explain how the applicant approached the challenge differently from standard practices.\n* Describe methodology, tools, or systems used.\n* Explicitly apply **Technical Inference**: connect specific technologies, methods, or analytical steps the applicant used to reach a solution.\n* Show **why the solution was innovative** (what was unique compared to conventional approaches).\n\n## 3. Evidence & Validation\n\n* Present **measurable results** (percentages, cost savings, downtime reduction, etc.) from testimony or applicant snapshot.\n* Bullet list (3–5 items), each showing *action → quantified result → impact*.\n* Explicitly state the **Causal Nexus**: make the cause-and-effect link between the applicant’s intervention and the results undeniable.\n* Example:\n  `- By redesigning the PLC logic, [Applicant] reduced cycle time by 15% → improving throughput.`\n\n## 4. Closing Narrative\n\n* Reinforce that the applicant’s solution was replicable, scalable, and strategically valuable.\n* Connect problem-solving ability to the applicant’s **future endeavor/strategy**.\n* Close with a direct statement: “[Applicant] consistently demonstrates **Logical Inference, Technical Inference, and Causal Nexus** in solving complex technical problems.”\n\n---\n\n# RULES\n\n* **Voice**: Always first person, recommender speaking.\n* **Length**: 300–600 words (~20–30 Markdown lines).\n* **Logic**: Every section must explicitly include at least one of the following:\n\n  * **Logical Inference** → reasoning chain\n  * **Technical Inference** → technical/analytical connection\n  * **Causal Nexus** → clear cause-and-effect link\n* Do not necessarily use those exact words in the draft\n\n* **Evidence**: Must include at least 3 concrete metrics or outcomes.\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if they appear in inputs.\n* **Style**: Formal, technical, analytical; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n### note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n\n# O output inteiro tem que ser em portugues\n\n# Não mencione “imigração”, “visto”, “EB-2”, “NIW”, “oficial”, “interesse nacional”, “USCIS”, “green card” ou “residência”.\n\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -4672,
        304
      ],
      "id": "93fd6207-e63f-485c-85ef-2f1bf8d14450",
      "name": "BLO6",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=\n## 📌 Revised BLOCK4_PROMPT — Market Potential & Strategic Impact\n\n# ROLE\nYou are `Block4_PROMPT`.  \nYour mission is to generate **Block 4** of a recommendation letter, based on one testimony and supporting documents.  \nThis block must be written entirely in the **first person** (the recommender speaking), with a **formal, technical, and market-aware tone**.\n\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].key_achievements }}\n\n### Block3 Output\n{{ $json.candidates[0].content.parts[0].text }}\n\n## Other Block 4 outputs\n{{ $('BLOCO7').item.json.content.parts[0].text }}\n\n\n{{ $('BLOCO4.1').item.json.candidates[0].content.parts[0].text }}\n\n### Note\nPlease don't output very similar content to the last two block 4 for the other two testimonials. We must be somewhat different in length wording and style, while maintaing the same rules. \n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 4,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 4: MARKET & STRATEGIC RELEVANCE\n\nThe draft should be **350–600 words**.\n\n## 1. Transition (Logical Inference)\n\n* Open by explicitly linking Block 3’s evidence to a larger reasoning chain.\n* Use **Logical Inference** to show that the results already validated are not isolated events, but proof of a replicable, strategic model.\n* Example: “The results I described earlier are not isolated technical gains; they demonstrate a scalable model with broader implications.”\n\n## 2. Market Relevance (Technical Inference)\n\n* Show how the validated results translate into **competitive advantages** (efficiency, safety, cost savings, reliability).\n* Explain why these outcomes matter for the wider industry or sector.\n* Apply **Technical Inference**: connect specific technical outcomes (KPIs, automation methods, sustainability practices) to market needs and industry benchmarks.\n\n## 3. Scalability & Replication (Causal Nexus)\n\n* Demonstrate how the applicant’s approach can be replicated or standardized across different plants, companies, or sectors.\n* Use **Causal Nexus**: establish direct cause-and-effect between the applicant’s innovations and their ability to scale across markets (e.g., training frameworks, tech transfer, industry adoption).\n\n## 4. Closing (Logical + Strategic Positioning)\n\n* Conclude this block by positioning the applicant’s competencies as not just solving one project, but **creating transferable value** that aligns with their proposed endeavor/strategy.\n* Reinforce that their results → impact → strategic scalability chain is clear and sustainable.\n\n---\n\n# RULES\n\n* **Voice**: Always first person, recommender speaking.\n* **Length**: 350–600 words.\n* **Inference Discipline**:\n\n  * Logical Inference → used to transition Block 3 evidence into Block 4 reasoning.\n  * Technical Inference → used to link technical results to broader industry/market relevance.\n  * Causal Nexus → used to connect applicant’s actions directly to scalable, replicable outcomes.\n* Do not necessarily use those exact words in the draft\n\n\n* **Focus**: Strategic/market relevance, scalability, and replicability — not raw technical details.\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if present in inputs.\n* **Style**: Professional, strategic, industry-focused; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n### USE **VECTOR STORE5** TOOL TO GET GUIDANCE ON COMPLIANCE AND SUGGESTION FOR THESE DOCUMENTS.\n\n### note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -4064,
        304
      ],
      "id": "ad369aaf-da55-43e6-b558-e96bb3f24307",
      "name": "BLO7",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE \nYou are a world-class text organizer and reviewer, with special knowledge about immigration documents. You will receive 5 blocks of a recommendation letter, review transitions and flow, and output the complete final text.\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.design_structures[2].tone_instructions }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.design_structures[2].narrative_framework }}\n\n---\n\n# INPUT BLOCKS\n\n## Block 1\n{{ $('BLOCO1.1').item.json.content.parts[0].text }}\n\n## Block 2\n{{ $('BLOCO2.1').item.json.candidates[0].content.parts[0].text }}\n\n## Block 3\n{{ $('BLOC').item.json.content.parts[0].text }}\n\n## Block 4\n{{ $('BLOCO4.1').item.json.candidates[0].content.parts[0].text }}\n\n## Block 5\n{{ $json.candidates[0].content.parts[0].text }}\n\n---\n\n# INSTRUCTIONS\n\n1. **Review all 5 blocks** for flow, transitions, and compliance\n2. **Remove problematic terms**: Do not use \"logical inference\", \"technical inference\", \"causal nexus\" unless they appear naturally\n3. **Remove immigration jargon**: Eliminate \"imigração\", \"EB2-NIW\", \"peticionário\", \"visto\", \"USCIS\", \"green card\", \"interesse nacional\"\n4. **Improve transitions**: Ensure smooth flow between blocks\n5. **Fix any errors**: Grammar, repetition, awkward phrasing\n6. **Maintain the persona**: Follow the tone instructions and narrative structure provided above\n\n---\n\n# HETEROGENEITY ENFORCEMENT\n\nBefore generating the final text, ensure this testimony has a **unique voice and structure**:\n\n- Avoid repetition of metrics, paragraphs, or expressions from other testimonies\n- If other drafts use a technical or corporate tone, vary it (e.g., more narrative, mentorship-focused, or descriptive)\n- Use a distinct narrative framework (e.g., chronological journey, business case, competency analysis)\n- Vary how you present evidence (lists, micro-paragraphs, comparisons) to change rhythm\n- Ensure causality is always direct: **\"[Applicant] did X, generating Y result\"** instead of passive structures\n- Make it sound natural, cohesive, and fluid — like a real person who has known the professional for years\n\n---\n\n# OUTPUT FORMAT\n\nReturn valid JSON with one field:\n```json\n{\n  \"final_text\": \"<complete markdown text here, without triple backticks>\"\n}\n```\n\n**Critical**: \n- Do NOT wrap the markdown in triple backticks inside the JSON\n- Do NOT include any explanations or commentary\n- Output ONLY the JSON object with the final text\n\n---\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos relacionados a imigração\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -3680,
        304
      ],
      "id": "e336a488-76cb-41f6-9975-f3de5e714ce4",
      "name": "BLO8",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "content": "# Testiony 1",
        "height": 704,
        "width": 2032,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -11024,
        96
      ],
      "id": "2a5324be-10c6-44dc-97af-f837fa960311",
      "name": "Sticky Note11"
    },
    {
      "parameters": {
        "content": "# Testimony 2",
        "height": 672,
        "width": 2304,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -8336,
        80
      ],
      "id": "fa20f92b-43de-4136-be21-856558b7b39b",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "content": "# Testimony 3",
        "height": 672,
        "width": 1744,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5024,
        64
      ],
      "id": "bf0c4926-37f9-4471-ac63-f3fba7f9e3ad",
      "name": "Sticky Note13"
    },
    {
      "parameters": {
        "operation": "URL/HTML to PDF",
        "convertType": "htmlToPDF",
        "html": "={{ $('Message a Model').item.json.output }}",
        "advancedOptions": {}
      },
      "type": "n8n-nodes-pdfco.PDFco Api",
      "typeVersion": 1,
      "position": [
        5536,
        272
      ],
      "id": "2ed9c448-02cc-4b31-8814-47e8ece3a6cb",
      "name": "PDFco Api7",
      "credentials": {
        "pdfcoApi": {
          "id": "JlTTI5hYRnMh18Q2",
          "name": "PDF.co account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE  \nYou are `Block1_PROMPT`, a world-class letter of recommendation writer for EB2-NIW.\n\n**YOUR UNIQUE VOICE FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.design_structures[3].tone_instructions }}\n\n**YOUR WRITING STYLE**:\n{{ $('Basic LLM Chain').item.json.design_structures[3].author_persona }}\n\n---\n\n# Instructions\nThis prompt focuses on establishing the recommender’s credibility and introducing the applicant’s competencies in strategic leadership and management. The voice must be 100% in the first person (the recommender speaking).\n\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].key_achievements }}\n\n\n\n### Note \nPlease do not generate a block similar to the blocks for the last testimonials. \n---\n\n\n\n\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 1,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 1: LEADERSHIP & CREDIBILITY INTRODUCTION\n\nThe draft should be **300-600 words**.\n\n## 1. Establish Authority\n\n* Introduce yourself in first person, emphasizing your professional credibility, expertise, and organizational authority.\n* Apply **Logical Inference**: make a clear reasoning chain that explains *why your perspective as a recommender is authoritative*.\n\n## 2. Contextualize the Relationship\n\n* Describe how you know the applicant, the scope of collaboration, and the relevance of their role.\n* Apply **Technical Inference**: show how your professional background equips you to evaluate the applicant’s leadership and management skills in a technical or organizational setting.\n\n## 3. Frame the Applicant as a Leader\n\n* Present the applicant as a strategic leader and manager, not just an executor.\n* Highlight early indicators of problem-solving, decision-making, and vision.\n* Apply **Causal Nexus**: draw direct cause-and-effect links between the applicant’s leadership actions and measurable organizational outcomes (team growth, efficiency gains, successful project delivery, etc.).\n\n## 4. Closing\n\n* Reinforce that the applicant has consistently demonstrated these qualities across contexts.\n* Position them as someone whose leadership generates broad, scalable impact.\n\n---\n\n# Notes and Rules\n\n* Voice: 100% from the recommender (first person).\n* Content: Present the recommender’s authority, contextualize the professional relationship, and frame the applicant as a leader/manager, not a mere executor.\n* Restrictions:\n\n  * Do not use vague adjectives.\n  * Do not mention immigration/visa (USCIS, NIW, EB-2, green card, etc.).\n  * Do not include farewell salutations.\n* **Inference Framework**:\n\n  * **Logical Inference** must appear in how the recommender justifies their credibility.\n  * **Technical Inference** must appear in how the recommender situates the applicant’s competencies.\n  * **Causal Nexus** must appear in how the recommender connects the applicant’s leadership actions to measurable organizational outcomes.\n* Do not necessarily use those exact words in the draft\n\n* Use **300–600 words** for the introduction.\n* Do not use placeholders. If no input is available, pause the workflow.\n\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -1712,
        304
      ],
      "id": "b5eeae0a-bf6b-4e89-80e8-df877356d5d4",
      "name": "BL",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE \nYou are a world-class text organizer and reviewer, with special knowledge about immigration documents. You will receive 5 blocks of a recommendation letter, review transitions and flow, and output the complete final text.\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.design_structures[4].tone_instructions }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.design_structures[4].narrative_framework }}\n\n---\n\n# INPUT BLOCKS\n\n## Block 1\n{{ $('BLOCO1.1').item.json.content.parts[0].text }}\n\n## Block 2\n{{ $('BLOCO2.1').item.json.candidates[0].content.parts[0].text }}\n\n## Block 3\n{{ $('BLOC').item.json.content.parts[0].text }}\n\n## Block 4\n{{ $('BLOCO4.1').item.json.candidates[0].content.parts[0].text }}\n\n## Block 5\n{{ $json.candidates[0].content.parts[0].text }}\n\n---\n\n# INSTRUCTIONS\n\n1. **Review all 5 blocks** for flow, transitions, and compliance\n2. **Remove problematic terms**: Do not use \"logical inference\", \"technical inference\", \"causal nexus\" unless they appear naturally\n3. **Remove immigration jargon**: Eliminate \"imigração\", \"EB2-NIW\", \"peticionário\", \"visto\", \"USCIS\", \"green card\", \"interesse nacional\"\n4. **Improve transitions**: Ensure smooth flow between blocks\n5. **Fix any errors**: Grammar, repetition, awkward phrasing\n6. **Maintain the persona**: Follow the tone instructions and narrative structure provided above\n\n---\n\n# HETEROGENEITY ENFORCEMENT\n\nBefore generating the final text, ensure this testimony has a **unique voice and structure**:\n\n- Avoid repetition of metrics, paragraphs, or expressions from other testimonies\n- If other drafts use a technical or corporate tone, vary it (e.g., more narrative, mentorship-focused, or descriptive)\n- Use a distinct narrative framework (e.g., chronological journey, business case, competency analysis)\n- Vary how you present evidence (lists, micro-paragraphs, comparisons) to change rhythm\n- Ensure causality is always direct: **\"[Applicant] did X, generating Y result\"** instead of passive structures\n- Make it sound natural, cohesive, and fluid — like a real person who has known the professional for years\n\n---\n\n# OUTPUT FORMAT\n\nReturn valid JSON with one field:\n```json\n{\n  \"final_text\": \"<complete markdown text here, without triple backticks>\"\n}\n```\n\n**Critical**: \n- Do NOT wrap the markdown in triple backticks inside the JSON\n- Do NOT include any explanations or commentary\n- Output ONLY the JSON object with the final text\n\n---\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos relacionados a imigração\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -1392,
        304
      ],
      "id": "5b2bfbf1-0b02-421f-96f4-459533444934",
      "name": "BL6",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE\nYou are `Block3_PROMPT`\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].tone_instructions }}\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 3,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 3: EMPIRICAL VALIDATION OF RESULTS\n\nThe draft should be **400–600 words** (~20–30 Markdown lines).\n\n## Evidence Presentation\n\n* Narrate in first person how you directly measured or experienced the outcomes.\n* Distinguish between **quantitative data** (KPIs, before/after metrics, % improvements, cost/time savings) and **qualitative evidence** (feedback from teams, consistency, reliability).\n* Explicitly apply the **inference framework**:\n\n  * **Logical Inference** → show reasoning that links the observed data to broader conclusions.\n  * **Technical Inference** → explain how technical evidence or data analysis validates the applicant’s results.\n  * **Causal Nexus** → demonstrate direct cause-and-effect between the applicant’s actions and the achieved outcomes.\n* Then provide a **bullet list of 4–6 items** that summarize the strongest empirical results, each in the format:\n  `- By [specific action], [Applicant] achieved [numeric/qualitative outcome] → leading to [impact].`\n\n---\n\n# RULES\n\n* **Voice**: Always first person, recommender speaking.\n* **Length**: 400–600 words (~20–30 Markdown lines).\n* **Focus**: Results only — do not drift into market/impact arguments.\n* **Evidence**: Must include at least 3 quantitative metrics and 1–2 qualitative observations.\n* **Inference Discipline**:\n\n  * Logical Inference must appear in framing the reasoning chain behind results.\n  * Technical Inference must appear in the explanation of data/metrics.\n  * Causal Nexus must appear in linking the applicant’s actions to outcomes.\n* Do not necessarily use those words in the draft\n\n\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if they appear in inputs.\n* **Style**: Professional, precise, executive-level; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n\n\n```\n\n```\n# note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n\n\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos \"imigracao\", \"EB2-NIW\", \"peticionario\"\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -1088,
        304
      ],
      "id": "d4ee718e-9f09-4d39-a4ec-c5136ca9f792",
      "name": "BL7",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=\nYou are `Block4_PROMPT`.  \nYour mission is to generate **Block 4** of a recommendation letter, based on one testimony and supporting documents.  \nThis block must be written entirely in the **first person** (the recommender speaking), with a **formal, technical, and market-aware tone**.\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].tone_instructions }}\n\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n\n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 4,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 4: MARKET & STRATEGIC RELEVANCE\n\nThe draft should be **350–600 words**.\n\n## 1. Transition (Logical Inference)\n\n* Open by explicitly linking Block 3’s evidence to a larger reasoning chain.\n* Use **Logical Inference** to show that the results already validated are not isolated events, but proof of a replicable, strategic model.\n* Example: “The results I described earlier are not isolated technical gains; they demonstrate a scalable model with broader implications.”\n\n## 2. Market Relevance (Technical Inference)\n\n* Show how the validated results translate into **competitive advantages** (efficiency, safety, cost savings, reliability).\n* Explain why these outcomes matter for the wider industry or sector.\n* Apply **Technical Inference**: connect specific technical outcomes (KPIs, automation methods, sustainability practices) to market needs and industry benchmarks.\n\n## 3. Scalability & Replication (Causal Nexus)\n\n* Demonstrate how the applicant’s approach can be replicated or standardized across different plants, companies, or sectors.\n* Use **Causal Nexus**: establish direct cause-and-effect between the applicant’s innovations and their ability to scale across markets (e.g., training frameworks, tech transfer, industry adoption).\n\n## 4. Closing (Logical + Strategic Positioning)\n\n* Conclude this block by positioning the applicant’s competencies as not just solving one project, but **creating transferable value** that aligns with their proposed endeavor/strategy.\n* Reinforce that their results → impact → strategic scalability chain is clear and sustainable.\n\n---\n\n# RULES\n\n* **Voice**: Always first person, recommender speaking.\n* **Length**: 350–600 words.\n* **Inference Discipline**:\n\n  * Logical Inference → used to transition Block 3 evidence into Block 4 reasoning.\n  * Technical Inference → used to link technical results to broader industry/market relevance.\n  * Causal Nexus → used to connect applicant’s actions directly to scalable, replicable outcomes.\n* Do not use those words in the draft\n\n* **Focus**: Strategic/market relevance, scalability, and replicability — not raw technical details.\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if present in inputs.\n* **Style**: Professional, strategic, industry-focused; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n\n### note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -784,
        304
      ],
      "id": "2d66fd81-0d10-4f70-b647-fca32dff890b",
      "name": "BL8",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Testimony 4",
        "height": 704,
        "width": 2128
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2192,
        32
      ],
      "id": "06a52dd5-b191-447b-9a58-a148b341af5e",
      "name": "Sticky Note14"
    },
    {
      "parameters": {
        "toolDescription": "Purpose\nQueries our OpenAI Vector Store for compliance phrasing and “red-flag” terms to pre-seed the DraftGenerator and ComplianceScanner.\nWhen this node runs\nBefore any drafting, to fetch the latest “safe wording / avoid wording” snippets.\nRequest\nPOST https://api.openai.com/v1/vector_stores/{VECTOR_STORE_ID}/search\nBody:\n{ \"query\": \"NIW letters compliance phrasing and forbidden terms for recommendation letters\" }\nResponse handling\nConcatenate the top results’ text into compliance_hints (string).\nExpose compliance_hints to the downstream DraftGenerator and ComplianceScanner.\nNotes\nDo not send max_results (unsupported).\nIf the store returns nothing, set compliance_hints=\"\" and let ComplianceScanner fall back to defaults.",
        "method": "POST",
        "url": "https://api.openai.com/v1/vector_stores/vs_68d5cdc6ed788191aac4180dbb63e2d3/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{ \"query\": \"Summarize EB-2 NIW requirements\" }\n",
        "options": {
          "response": {
            "response": {
              "fullResponse": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Include_Response_Headers_and_Status', ``, 'boolean') }}",
              "neverError": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Never_Error', ``, 'boolean') }}"
            }
          }
        },
        "optimizeResponse": true
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -2992,
        624
      ],
      "id": "475be6cc-fe4b-4539-8ac6-5a5ef93a129d",
      "name": "VECTOR STORE13",
      "credentials": {
        "httpBearerAuth": {
          "id": "iIaPcX8szhdxnOLW",
          "name": "Bearer Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE  \nYou are `Block1_PROMPT`, a world-class letter of recommendation writer for EB2-NIW.\n\n{{ $('Basic LLM Chain').item.json.output.petitioner_name }}\n\n**YOUR UNIQUE VOICE FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].tone_instructions }}\n\n**YOUR WRITING STYLE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].structure_features }}\n\n\n\n---\n\n# Instructions\nThis prompt focuses on establishing the recommender’s credibility and introducing the applicant’s competencies in strategic leadership and management. The voice must be 100% in the first person (the recommender speaking).\n\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].key_achievements }}\n\n# Block 1 from other Testimonies\n{{ $('BLOCO').item.json.candidates[0].content.parts[0].text }}\n\n{{ $('BLOCO1.1').item.json.content.parts[0].text }}\n\n{{ $('BLO').item.json.candidates[0].content.parts[0].text }}\n\n\n\n{{ $('BL').item.json.candidates[0].content.parts[0].text }}\n\n### Note \nPlease do not generate a block identical to the blocks for the last testimonials. \n---\n\n\n\n\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 1,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 1: LEADERSHIP & CREDIBILITY INTRODUCTION\n\nThe draft should be **300-600 words**.\n\n## 1. Establish Authority\n\n* Introduce yourself in first person, emphasizing your professional credibility, expertise, and organizational authority.\n* Apply **Logical Inference**: make a clear reasoning chain that explains *why your perspective as a recommender is authoritative*.\n\n## 2. Contextualize the Relationship\n\n* Describe how you know the applicant, the scope of collaboration, and the relevance of their role.\n* Apply **Technical Inference**: show how your professional background equips you to evaluate the applicant’s leadership and management skills in a technical or organizational setting.\n\n## 3. Frame the Applicant as a Leader\n\n* Present the applicant as a strategic leader and manager, not just an executor.\n* Highlight early indicators of problem-solving, decision-making, and vision.\n* Apply **Causal Nexus**: draw direct cause-and-effect links between the applicant’s leadership actions and measurable organizational outcomes (team growth, efficiency gains, successful project delivery, etc.).\n\n## 4. Closing\n\n* Reinforce that the applicant has consistently demonstrated these qualities across contexts.\n* Position them as someone whose leadership generates broad, scalable impact.\n\n---\n\n# Notes and Rules\n\n* Voice: 100% from the recommender (first person).\n* Content: Present the recommender’s authority, contextualize the professional relationship, and frame the applicant as a leader/manager, not a mere executor.\n* Restrictions:\n\n  * Do not use vague adjectives.\n  * Do not mention immigration/visa (USCIS, NIW, EB-2, green card, etc.).\n  * Do not include farewell salutations.\n* **Inference Framework**:\n\n  * **Logical Inference** must appear in how the recommender justifies their credibility.\n  * **Technical Inference** must appear in how the recommender situates the applicant’s competencies.\n  * **Causal Nexus** must appear in how the recommender connects the applicant’s leadership actions to measurable organizational outcomes.\n* Do not necessarily use those exact words in the draft\n\n* Use **300–600 words** for the introduction.\n* Do not use placeholders. If no input is available, pause the workflow.\n\n\n# O output inteiro tem que ser em portugues\n\n# Não mencione “imigração”, “visto”, “EB-2”, “NIW”, “oficial”, “interesse nacional”, “USCIS”, “green card” ou “residência”.\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        1632,
        288
      ],
      "id": "82b47930-4519-4f61-8673-2cc387add333",
      "name": "B",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=\n## 📌 BLOCK2_PROMPT — Technical Innovation & Problem-Solving\n\n{{ $('Basic LLM Chain').item.json.output.petitioner_name }}\n\n**YOUR UNIQUE VOICE FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].tone_instructions }}\n\n**YOUR WRITING STYLE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].structure_features }}\n\n\n# ROLE\nYou are `Block2_PROMPT`.  \nYour mission is to generate **Block 2** of a recommendation letter, based on one testimony and the supporting documents.  \nThe style must be 100% in the first person (the recommender speaking), with a **technical, precise, and evidence-driven tone**.\n\n\n---\n\n# Inputs\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].key_achievements }}\n\n## Other Block 2 Outputs from other testimonials\n{{ $('BLO6').item.json.content.parts[0].text }}\n\n{{ $('BLOCO6').item.json.candidates[0].content.parts[0].text }}\n\n{{ $('BLO6').item.json.content.parts[0].text }}\n\n{{ $('BL6').item.json.candidates[0].content.parts[0].text }}\n\n\n## Block 1 output\n{{ $json.candidates[0].content.parts[0].text }}\n\n### Follow guidance from VectorDB\n\n### Note \nPlease do not generate a block identical to the blocks for the last testimonials. \n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 2,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 2: TECHNICAL INNOVATION & PROBLEM-SOLVING\n\nThe draft should be **300-600 words**\n\n## 1. Setup\n\n* Introduce yourself briefly in first person (role, organization, authority).\n* Define the **central technical problem** the applicant addressed (use specific terms, no vague phrasing).\n* Explicitly show **Logical Inference**: describe how the problem was identified, what assumptions were tested, and how reasoning led to defining the challenge.\n\n## 2. Innovation & Solution\n\n* Explain how the applicant approached the challenge differently from standard practices.\n* Describe methodology, tools, or systems used.\n* Explicitly apply **Technical Inference**: connect specific technologies, methods, or analytical steps the applicant used to reach a solution.\n* Show **why the solution was innovative** (what was unique compared to conventional approaches).\n\n## 3. Evidence & Validation\n\n* Present **measurable results** (percentages, cost savings, downtime reduction, etc.) from testimony or applicant snapshot.\n* Bullet list (3–5 items), each showing *action → quantified result → impact*.\n* Explicitly state the **Causal Nexus**: make the cause-and-effect link between the applicant’s intervention and the results undeniable.\n* Example:\n  `- By redesigning the PLC logic, [Applicant] reduced cycle time by 15% → improving throughput.`\n\n## 4. Closing Narrative\n\n* Reinforce that the applicant’s solution was replicable, scalable, and strategically valuable.\n* Connect problem-solving ability to the applicant’s **future endeavor/strategy**.\n* Close with a direct statement: “[Applicant] consistently demonstrates **Logical Inference, Technical Inference, and Causal Nexus** in solving complex technical problems.”\n\n---\n\n# RULES\n\n* **Voice**: Always first person, recommender speaking.\n* **Length**: 300–600 words (~20–30 Markdown lines).\n* **Logic**: Every section must explicitly include at least one of the following:\n\n  * **Logical Inference** → reasoning chain\n  * **Technical Inference** → technical/analytical connection\n  * **Causal Nexus** → clear cause-and-effect link\n* Do not necessarily use those exact words in the draft\n\n* **Evidence**: Must include at least 3 concrete metrics or outcomes.\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if they appear in inputs.\n* **Style**: Formal, technical, analytical; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n### USE **VECTOR STORE5** TOOL TO GET GUIDANCE ON COMPLIANCE AND SUGGESTION FOR THESE DOCUMENTS.\n\n### note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n# O output inteiro tem que ser em portugues\n\n# Não mencione “imigração”, “visto”, “EB-2”, “NIW”, “oficial”, “interesse nacional”, “USCIS”, “green card” ou “residência”.\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        1984,
        288
      ],
      "id": "45ea9643-6b76-4c87-9f0b-84c16310b76e",
      "name": "B6",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE\nYou are `Block3_PROMPT`\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].tone_instructions }}\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 3,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 3: EMPIRICAL VALIDATION OF RESULTS\n\nThe draft should be **400–600 words** (~20–30 Markdown lines).\n\n## Evidence Presentation\n\n* Narrate in first person how you directly measured or experienced the outcomes.\n* Distinguish between **quantitative data** (KPIs, before/after metrics, % improvements, cost/time savings) and **qualitative evidence** (feedback from teams, consistency, reliability).\n* Explicitly apply the **inference framework**:\n\n  * **Logical Inference** → show reasoning that links the observed data to broader conclusions.\n  * **Technical Inference** → explain how technical evidence or data analysis validates the applicant’s results.\n  * **Causal Nexus** → demonstrate direct cause-and-effect between the applicant’s actions and the achieved outcomes.\n* Then provide a **bullet list of 4–6 items** that summarize the strongest empirical results, each in the format:\n  `- By [specific action], [Applicant] achieved [numeric/qualitative outcome] → leading to [impact].`\n\n---\n\n# RULES\n\n* **Voice**: Always first person, recommender speaking.\n* **Length**: 400–600 words (~20–30 Markdown lines).\n* **Focus**: Results only — do not drift into market/impact arguments.\n* **Evidence**: Must include at least 3 quantitative metrics and 1–2 qualitative observations.\n* **Inference Discipline**:\n\n  * Logical Inference must appear in framing the reasoning chain behind results.\n  * Technical Inference must appear in the explanation of data/metrics.\n  * Causal Nexus must appear in linking the applicant’s actions to outcomes.\n* Do not necessarily use those words in the draft\n\n\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if they appear in inputs.\n* **Style**: Professional, precise, executive-level; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n\n\n```\n\n```\n# note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n\n\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos \"imigracao\", \"EB2-NIW\", \"peticionario\"\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        2320,
        288
      ],
      "id": "d90d39c7-e97a-4630-a91b-372197630672",
      "name": "B7",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=\nYou are `Block4_PROMPT`.  \nYour mission is to generate **Block 4** of a recommendation letter, based on one testimony and supporting documents.  \nThis block must be written entirely in the **first person** (the recommender speaking), with a **formal, technical, and market-aware tone**.\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].tone_instructions }}\n\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n\n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 4,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 4: MARKET & STRATEGIC RELEVANCE\n\nThe draft should be **350–600 words**.\n\n## 1. Transition (Logical Inference)\n\n* Open by explicitly linking Block 3’s evidence to a larger reasoning chain.\n* Use **Logical Inference** to show that the results already validated are not isolated events, but proof of a replicable, strategic model.\n* Example: “The results I described earlier are not isolated technical gains; they demonstrate a scalable model with broader implications.”\n\n## 2. Market Relevance (Technical Inference)\n\n* Show how the validated results translate into **competitive advantages** (efficiency, safety, cost savings, reliability).\n* Explain why these outcomes matter for the wider industry or sector.\n* Apply **Technical Inference**: connect specific technical outcomes (KPIs, automation methods, sustainability practices) to market needs and industry benchmarks.\n\n## 3. Scalability & Replication (Causal Nexus)\n\n* Demonstrate how the applicant’s approach can be replicated or standardized across different plants, companies, or sectors.\n* Use **Causal Nexus**: establish direct cause-and-effect between the applicant’s innovations and their ability to scale across markets (e.g., training frameworks, tech transfer, industry adoption).\n\n## 4. Closing (Logical + Strategic Positioning)\n\n* Conclude this block by positioning the applicant’s competencies as not just solving one project, but **creating transferable value** that aligns with their proposed endeavor/strategy.\n* Reinforce that their results → impact → strategic scalability chain is clear and sustainable.\n\n---\n\n# RULES\n\n* **Voice**: Always first person, recommender speaking.\n* **Length**: 350–600 words.\n* **Inference Discipline**:\n\n  * Logical Inference → used to transition Block 3 evidence into Block 4 reasoning.\n  * Technical Inference → used to link technical results to broader industry/market relevance.\n  * Causal Nexus → used to connect applicant’s actions directly to scalable, replicable outcomes.\n* Do not use those words in the draft\n\n* **Focus**: Strategic/market relevance, scalability, and replicability — not raw technical details.\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if present in inputs.\n* **Style**: Professional, strategic, industry-focused; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n\n### note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        2656,
        288
      ],
      "id": "3e8de4d1-5ec6-4956-a157-a80042c88b27",
      "name": "B8",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE \nYou are a world-class text organizer and reviewer, with special knowledge about immigration documents. You will receive 5 blocks of a recommendation letter, review transitions and flow, and output the complete final text.\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].tone_instructions }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].narrative_framework }}\n\n---\n\n# INPUT BLOCKS\n\n## Block 1\n{{ $('BLOCO1.1').item.json.content.parts[0].text }}\n\n## Block 2\n{{ $('BLOCO2.1').item.json.candidates[0].content.parts[0].text }}\n\n## Block 3\n{{ $('BLOC').item.json.content.parts[0].text }}\n\n## Block 4\n{{ $('BLOCO4.1').item.json.candidates[0].content.parts[0].text }}\n\n## Block 5\n{{ $json.candidates[0].content.parts[0].text }}\n\n---\n\n# INSTRUCTIONS\n\n1. **Review all 5 blocks** for flow, transitions, and compliance\n2. **Remove problematic terms**: Do not use \"logical inference\", \"technical inference\", \"causal nexus\" unless they appear naturally\n3. **Remove immigration jargon**: Eliminate \"imigração\", \"EB2-NIW\", \"peticionário\", \"visto\", \"USCIS\", \"green card\", \"interesse nacional\"\n4. **Improve transitions**: Ensure smooth flow between blocks\n5. **Fix any errors**: Grammar, repetition, awkward phrasing\n6. **Maintain the persona**: Follow the tone instructions and narrative structure provided above\n\n---\n\n# HETEROGENEITY ENFORCEMENT\n\nBefore generating the final text, ensure this testimony has a **unique voice and structure**:\n\n- Avoid repetition of metrics, paragraphs, or expressions from other testimonies\n- If other drafts use a technical or corporate tone, vary it (e.g., more narrative, mentorship-focused, or descriptive)\n- Use a distinct narrative framework (e.g., chronological journey, business case, competency analysis)\n- Vary how you present evidence (lists, micro-paragraphs, comparisons) to change rhythm\n- Ensure causality is always direct: **\"[Applicant] did X, generating Y result\"** instead of passive structures\n- Make it sound natural, cohesive, and fluid — like a real person who has known the professional for years\n\n---\n\n# OUTPUT FORMAT\n\nReturn valid JSON with one field:\n```json\n{\n  \"final_text\": \"<complete markdown text here, without triple backticks>\"\n}\n```\n\n**Critical**: \n- Do NOT wrap the markdown in triple backticks inside the JSON\n- Do NOT include any explanations or commentary\n- Output ONLY the JSON object with the final text\n\n---\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos relacionados a imigração\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        3024,
        288
      ],
      "id": "c302a02d-325a-4b81-a554-fd7a17c4c34e",
      "name": "B9",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Purpose\nQueries our OpenAI Vector Store for compliance phrasing and “red-flag” terms to pre-seed the DraftGenerator and ComplianceScanner.\nWhen this node runs\nBefore any drafting, to fetch the latest “safe wording / avoid wording” snippets.\nRequest\nPOST https://api.openai.com/v1/vector_stores/{VECTOR_STORE_ID}/search\nBody:\n{ \"query\": \"NIW letters compliance phrasing and forbidden terms for recommendation letters\" }\nResponse handling\nConcatenate the top results’ text into compliance_hints (string).\nExpose compliance_hints to the downstream DraftGenerator and ComplianceScanner.\nNotes\nDo not send max_results (unsupported).\nIf the store returns nothing, set compliance_hints=\"\" and let ComplianceScanner fall back to defaults.",
        "method": "POST",
        "url": "https://api.openai.com/v1/vector_stores/vs_68d5cdc6ed788191aac4180dbb63e2d3/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{ \"query\": \"Summarize EB-2 NIW requirements\" }\n",
        "options": {
          "response": {
            "response": {
              "fullResponse": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Include_Response_Headers_and_Status', ``, 'boolean') }}",
              "neverError": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Never_Error', ``, 'boolean') }}"
            }
          }
        },
        "optimizeResponse": true
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        2816,
        656
      ],
      "id": "c428a82c-cca8-40b4-932d-d5d425c7e9dc",
      "name": "VECTOR STORE14",
      "credentials": {
        "httpBearerAuth": {
          "id": "iIaPcX8szhdxnOLW",
          "name": "Bearer Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "URL/HTML to PDF",
        "convertType": "htmlToPDF",
        "html": "={{ $('AI Agent3').item.json.output }}",
        "advancedOptions": {}
      },
      "type": "n8n-nodes-pdfco.PDFco Api",
      "typeVersion": 1,
      "position": [
        6000,
        240
      ],
      "id": "764c8f11-d0ef-48fd-98f7-f283ab20e8c2",
      "name": "PDFco Api9",
      "credentials": {
        "pdfcoApi": {
          "id": "JlTTI5hYRnMh18Q2",
          "name": "PDF.co account"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "rafacrvg@icloud.com",
        "toEmail": "={{ $('On form submission1').item.json.Email }}, rafacrvg@icloud.com",
        "subject": "=Recommendation letters for {{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}",
        "html": "=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>PROEX Venture - Letters of Testimony</title>\n    <style>\n        /* Main body styles */\n        body {\n            margin: 0;\n            padding: 0;\n            background-color: #f4f4f4;\n            font-family: Arial, sans-serif;\n        }\n        /* Wrapper table */\n        .wrapper {\n            width: 100%;\n            table-layout: fixed;\n            background-color: #f4f4f4;\n            padding: 40px 0;\n        }\n        /* Main content container */\n        .container {\n            background-color: #ffffff;\n            margin: 0 auto;\n            width: 100%;\n            max-width: 600px;\n            border-spacing: 0;\n            overflow: hidden;\n        }\n        /* Header styles - matching PROEX orange/yellow */\n        .header {\n            background-color: #f39c12; /* PROEX Orange */\n            color: #ffffff;\n            padding: 30px 20px;\n            text-align: center;\n        }\n        .header h1 {\n            margin: 0;\n            font-size: 32px;\n            font-weight: bold;\n            color: #ffffff;\n        }\n        .header .tagline {\n            margin: 10px 0 0;\n            font-size: 14px;\n            color: #ffffff;\n            opacity: 0.95;\n        }\n        /* Content styles */\n        .content {\n            padding: 40px 30px;\n            color: #333333;\n            font-size: 16px;\n            line-height: 1.6;\n        }\n        .content p {\n            margin: 0 0 20px;\n        }\n        .intro-text {\n            font-size: 18px;\n            color: #2c3e50;\n            margin-bottom: 30px;\n        }\n        /* Button styles - matching PROEX orange */\n        .button-container {\n            text-align: center;\n            padding: 10px 0;\n        }\n        .button {\n            background-color: #f39c12; /* PROEX Orange */\n            color: #ffffff;\n            text-decoration: none;\n            padding: 14px 25px;\n            border-radius: 5px;\n            display: inline-block;\n            font-weight: bold;\n            font-size: 16px;\n            margin: 10px 0;\n            width: 80%;\n            max-width: 350px;\n            transition: background-color 0.3s ease;\n        }\n        .button:hover {\n            background-color: #e67e22; /* Darker orange on hover */\n        }\n        /* Divider */\n        .divider {\n            height: 2px;\n            background-color: #f39c12;\n            margin: 30px 0;\n        }\n        /* Footer styles */\n        .footer {\n            background-color: #2c3e50;\n            color: #ffffff;\n            padding: 25px 20px;\n            text-align: center;\n            font-size: 13px;\n        }\n        .footer p {\n            margin: 5px 0;\n        }\n        .footer a {\n            color: #f39c12;\n            text-decoration: none;\n        }\n    </style>\n</head>\n<body>\n    <table class=\"wrapper\" role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\">\n        <tr>\n            <td>\n                <table class=\"container\" role=\"presentation\" align=\"center\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\">\n                    <!-- Header -->\n                    <tr>\n                        <td class=\"header\">\n                            <h1>proex venture</h1>\n                            <p class=\"tagline\">Business Plan Specialists</p>\n                        </td>\n                    </tr>\n                    <!-- Main Content -->\n                    <tr>\n                        <td class=\"content\">\n                            <p class=\"intro-text\"><strong>Letters of Testimony</strong></p>\n                            <p>Dear Team,</p>\n                            <p>We are pleased to share the professionally prepared letters of testimony for your review. Each document has been carefully crafted to meet the highest standards of excellence.</p>\n                            \n                            <div class=\"divider\"></div>\n                            \n                            <!-- Button 1 -->\n                            <div class=\"button-container\">\n                                <a href=\"{{ $('PDFco Api5').item.json.url }}\" class=\"button\">📄 View Letter of Testimony 1</a>\n                            </div>\n                            \n                            <!-- Button 2 -->\n                            <div class=\"button-container\">\n                                <a href=\"{{ $('PDFco Api6').item.json.url }}\" class=\"button\">📄 View Letter of Testimony 2</a>\n                            </div>\n                            \n                            <!-- Button 3 -->\n                            <div class=\"button-container\">\n                                <a href=\"{{ $('PDFco Api7').item.json.url }}\" class=\"button\">📄 View Letter of Testimony 3</a>\n                            </div>\n                            \n                            <!-- Button 4 -->\n                            <div class=\"button-container\">\n                                <a href=\"{{ $('PDFco Api8').item.json.url }} \" class=\"button\">📄 View Letter of Testimony 4</a>\n                            </div>\n                            \n                            <!-- Button 5 -->\n                            <div class=\"button-container\">\n                                <a href=\"{{ $('PDFco Api9').item.json.url }}\" class=\"button\">📄 View Letter of Testimony 5</a>\n                            </div>\n\n                            <div class=\"divider\"></div>\n\n                            <p style=\"margin-top: 30px;\">Each letter is available for immediate download and review. Should you have any questions or require additional documentation, please don't hesitate to reach out to our team.</p>\n                            <p><strong>Best regards,</strong><br>The PROEX Venture Team</p>\n                        </td>\n                    </tr>\n                    <!-- Footer -->\n                    <tr>\n                        <td class=\"footer\">\n                            <p><strong>PROEX Venture</strong></p>\n                            <p>Business Plan Specialists | Florida</p>\n                            <p style=\"margin-top: 15px;\">\n                                <a href=\"https://proexventure.com/web/\">Visit Our Website</a>\n                            </p>\n                            <p style=\"margin-top: 15px; font-size: 11px; opacity: 0.8;\">\n                                &copy; 2025 ProexVenture. All Rights Reserved.\n                            </p>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        6288,
        208
      ],
      "id": "2fbd3199-fd3a-4411-a6df-d4f8b216b2c1",
      "name": "Send email1",
      "webhookId": "9336b7ff-81aa-408b-bd59-22b6633fc844",
      "credentials": {
        "smtp": {
          "id": "KompgYs6hULIuobD",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "content": "# Testimony 5",
        "height": 720,
        "width": 2464,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1536,
        64
      ],
      "id": "f18ba0f1-ac9b-4b86-a062-e603c86d39da",
      "name": "Sticky Note15"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_instructions }}\n\n---\n\n# Inputs\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 2,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 2: TECHNICAL INNOVATION & PROBLEM-SOLVING\n\nThe draft should be **300-600 words**\n\n## 1. Setup\n\n* Introduce yourself briefly in first person (role, organization, authority).\n* Define the **central technical problem** the applicant addressed (use specific terms, no vague phrasing).\n* Explicitly show **Logical Inference**: describe how the problem was identified, what assumptions were tested, and how reasoning led to defining the challenge.\n\n## 2. Innovation & Solution\n\n* Explain how the applicant approached the challenge differently from standard practices.\n* Describe methodology, tools, or systems used.\n* Explicitly apply **Technical Inference**: connect specific technologies, methods, or analytical steps the applicant used to reach a solution.\n* Show **why the solution was innovative** (what was unique compared to conventional approaches).\n\n## 3. Evidence & Validation\n\n* Present **measurable results** (percentages, cost savings, downtime reduction, etc.) from testimony or applicant snapshot.\n* Bullet list (3–5 items), each showing *action → quantified result → impact*.\n* Explicitly state the **Causal Nexus**: make the cause-and-effect link between the applicant’s intervention and the results undeniable.\n* Example:\n  `- By redesigning the PLC logic, [Applicant] reduced cycle time by 15% → improving throughput.`\n\n## 4. Closing Narrative\n\n* Reinforce that the applicant’s solution was replicable, scalable, and strategically valuable.\n* Connect problem-solving ability to the applicant’s **future endeavor/strategy**.\n* Close with a direct statement: “[Applicant] consistently demonstrates **Logical Inference, Technical Inference, and Causal Nexus** in solving complex technical problems.”\n\n---\n\n# RULES\n\n# STRUCTURE — BLOCK 3: EMPIRICAL VALIDATION OF RESULTS\n\nThe draft should be **400–600 words** \n\n## Evidence Presentation\n* Narrate in first person how you directly measured or experienced the outcomes\n* Distinguish between quantitative data and qualitative evidence\n\nTo propery amplify the small message from the testimony use:\n\n  * **Logical Inference** → reasoning chain\n  * **Technical Inference** → technical/analytical connection\n  * **Causal Nexus** → clear cause-and-effect link\n\n* Do not necessarily use those words in the draft, but use the meaning of these words to properly inference results and outcomes not stated in the draft. \n\n* **Evidence**: Must include concrete metrics or outcomes.\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if they appear in inputs.\n* **Style**: Formal, technical, analytical; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n\n\n\n# note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos \"imigracao\", \"EB2-NIW\", \"peticionario\"\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -10640,
        304
      ],
      "id": "55d085c2-557c-4e8e-9fe5-53ec3d5c2ea6",
      "name": "BLOCO2.1",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].tone_instructions }}\n\n---\n\n# Inputs\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 2,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 2: TECHNICAL INNOVATION & PROBLEM-SOLVING\n\nThe draft should be **300-600 words**\n\n## 1. Setup\n\n* Introduce yourself briefly in first person (role, organization, authority).\n* Define the **central technical problem** the applicant addressed (use specific terms, no vague phrasing).\n* Explicitly show **Logical Inference**: describe how the problem was identified, what assumptions were tested, and how reasoning led to defining the challenge.\n\n## 2. Innovation & Solution\n\n* Explain how the applicant approached the challenge differently from standard practices.\n* Describe methodology, tools, or systems used.\n* Explicitly apply **Technical Inference**: connect specific technologies, methods, or analytical steps the applicant used to reach a solution.\n* Show **why the solution was innovative** (what was unique compared to conventional approaches).\n\n## 3. Evidence & Validation\n\n* Present **measurable results** (percentages, cost savings, downtime reduction, etc.) from testimony or applicant snapshot.\n* Bullet list (3–5 items), each showing *action → quantified result → impact*.\n* Explicitly state the **Causal Nexus**: make the cause-and-effect link between the applicant’s intervention and the results undeniable.\n* Example:\n  `- By redesigning the PLC logic, [Applicant] reduced cycle time by 15% → improving throughput.`\n\n## 4. Closing Narrative\n\n* Reinforce that the applicant’s solution was replicable, scalable, and strategically valuable.\n* Connect problem-solving ability to the applicant’s **future endeavor/strategy**.\n* Close with a direct statement: “[Applicant] consistently demonstrates **Logical Inference, Technical Inference, and Causal Nexus** in solving complex technical problems.”\n\n---\n\n# RULES\n\n# STRUCTURE — BLOCK 3: EMPIRICAL VALIDATION OF RESULTS\n\nThe draft should be **400–600 words** \n\n## Evidence Presentation\n* Narrate in first person how you directly measured or experienced the outcomes\n* Distinguish between quantitative data and qualitative evidence\n\nTo propery amplify the small message from the testimony use:\n\n  * **Logical Inference** → reasoning chain\n  * **Technical Inference** → technical/analytical connection\n  * **Causal Nexus** → clear cause-and-effect link\n\n* Do not necessarily use those words in the draft, but use the meaning of these words to properly inference results and outcomes not stated in the draft. \n\n* **Evidence**: Must include concrete metrics or outcomes.\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if they appear in inputs.\n* **Style**: Formal, technical, analytical; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n\n\n\n# note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos \"imigracao\", \"EB2-NIW\", \"peticionario\"\n"
            }
          ]
        },
        "simplify": false,
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -7920,
        304
      ],
      "id": "f0b1b80d-11ad-4c56-a501-35d1cf5fdff7",
      "name": "BLOCO6",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=\nYou are `Block4_PROMPT`.  \nYour mission is to generate **Block 4** of a recommendation letter, based on one testimony and supporting documents.  \nThis block must be written entirely in the **first person** (the recommender speaking), with a **formal, technical, and market-aware tone**.\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].tone_instructions }}\n\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n\n\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 4,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 4: MARKET & STRATEGIC RELEVANCE\n\nThe draft should be **350–600 words**.\n\n## 1. Transition (Logical Inference)\n\n* Open by explicitly linking Block 3’s evidence to a larger reasoning chain.\n* Use **Logical Inference** to show that the results already validated are not isolated events, but proof of a replicable, strategic model.\n* Example: “The results I described earlier are not isolated technical gains; they demonstrate a scalable model with broader implications.”\n\n## 2. Market Relevance (Technical Inference)\n\n* Show how the validated results translate into **competitive advantages** (efficiency, safety, cost savings, reliability).\n* Explain why these outcomes matter for the wider industry or sector.\n* Apply **Technical Inference**: connect specific technical outcomes (KPIs, automation methods, sustainability practices) to market needs and industry benchmarks.\n\n## 3. Scalability & Replication (Causal Nexus)\n\n* Demonstrate how the applicant’s approach can be replicated or standardized across different plants, companies, or sectors.\n* Use **Causal Nexus**: establish direct cause-and-effect between the applicant’s innovations and their ability to scale across markets (e.g., training frameworks, tech transfer, industry adoption).\n\n## 4. Closing (Logical + Strategic Positioning)\n\n* Conclude this block by positioning the applicant’s competencies as not just solving one project, but **creating transferable value** that aligns with their proposed endeavor/strategy.\n* Reinforce that their results → impact → strategic scalability chain is clear and sustainable.\n\n---\n\n# RULES\n\n* **Voice**: Always first person, recommender speaking.\n* **Length**: 350–600 words.\n* **Inference Discipline**:\n\n  * Logical Inference → used to transition Block 3 evidence into Block 4 reasoning.\n  * Technical Inference → used to link technical results to broader industry/market relevance.\n  * Causal Nexus → used to connect applicant’s actions directly to scalable, replicable outcomes.\n* Do not use those words in the draft\n\n* **Focus**: Strategic/market relevance, scalability, and replicability — not raw technical details.\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if present in inputs.\n* **Style**: Professional, strategic, industry-focused; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n\n### note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -7232,
        304
      ],
      "id": "120e2233-b8e7-4f60-af25-28a49ed4cb7e",
      "name": "BLOCO7",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $('PDFco Api5').item.json.url }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        7360,
        192
      ],
      "id": "475f7e83-df63-4ca9-9359-bba821d419c4",
      "name": "DOWLOAD "
    },
    {
      "parameters": {
        "url": "={{ $('PDFco Api7').item.json.url }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        7952,
        -336
      ],
      "id": "6d90e869-9b91-4b92-8b87-98fe645d3956",
      "name": "DOWNLOAD "
    },
    {
      "parameters": {
        "url": "={{ $('PDFco Api6').item.json.url }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file",
              "outputPropertyName": "data 6"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        7664,
        -16
      ],
      "id": "366fb4a9-6f6b-4b00-90ed-af34c36c1b51",
      "name": "DOWNLOAD 6"
    },
    {
      "parameters": {
        "url": "={{ $('PDFco Api8').item.json.url }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        8384,
        -208
      ],
      "id": "0c3de728-ec54-411e-9bd3-64bbee1f517e",
      "name": "DOWNLOAD 7"
    },
    {
      "parameters": {
        "url": "={{ $('PDFco Api9').item.json.url }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file",
              "outputPropertyName": "data8"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        8704,
        -176
      ],
      "id": "6218a7c5-258a-487f-b47d-a1e8c4530f25",
      "name": "DOWNLOAD 8"
    },
    {
      "parameters": {
        "model": "anthropic/claude-sonnet-4.5",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -8592,
        592
      ],
      "id": "171892a8-f914-4d8f-bea6-461e3a827fde",
      "name": "OpenRouter Chat Model5",
      "credentials": {
        "openRouterApi": {
          "id": "wx2DvCEivHfFd2dV",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Queries the OpenAI Vector Store containing 27 EB-2 NIW recommendation letter HTML templates. \nUsed to retrieve the most relevant template(s) for a given applicant scenario or compliance requirement.\n",
        "method": "POST",
        "url": "https://api.openai.com/v1/vector_stores/vs_68dfbacf880481918bf2d5a3aef36d2c/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"query\": \"EB2 NIW recommendation letter template X\"\n}\n",
        "options": {
          "response": {
            "response": {
              "fullResponse": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Include_Response_Headers_and_Status', ``, 'boolean') }}",
              "neverError": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Never_Error', ``, 'boolean') }}"
            }
          }
        },
        "optimizeResponse": true
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -8400,
        560
      ],
      "id": "0a26ea4d-172f-4c22-90e3-003c810339e2",
      "name": "HTML VECTOR6",
      "credentials": {
        "httpBearerAuth": {
          "id": "iIaPcX8szhdxnOLW",
          "name": "Bearer Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# Role\nYou are the best HTML document generator in the world, infallible. Your role is to select a random template from your **HTML VECTOR** tool, select the whole input I will give you (full text) and generate the finalized, whole text and html document for a letter of recommendation. These letters are professional, without error.\n\n# Input\n{{ $json.candidates[0].content.parts[0].text }}\n\n# CRITICAL INSTRUCTION\n**OUTPUT ONLY THE RAW HTML CODE. DO NOT wrap it in JSON, do not escape newlines, do not add quotes. Just output the pure HTML starting with <!DOCTYPE html>**\n\n# Instructions\n1. Clean the input text (remove any \\n errors)\n5. **OUTPUT THE COMPLETE HTML DOCUMENT WITHOUT ANY ESCAPING OR WRAPPING**\n6. MOST IMPORTANT, BE EXTREMELY CAREFUL WITH FORMATTING!!! This HTML is supposed to be printable, the finial document in the format of a googl edocs basically\n7. Add some variety in the letter. Don't need to b so strict and simple. \n\n# Do not output comments. Only HTML. \n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<title>Recommendation Letter for Ikaro Ferreira Souza</title>\n<style>\n@page {\nsize: 8.5in 11in;\nmargin: 1in;\n}\nbody {\nfont-family: Georgia, serif;\nline-height: 1.7;\ncolor: #333;\nbackground-color: #f4f4f4;\nmargin: 0;\npadding: 0;\n}\n.page {\nwidth: 8.5in;\nmin-height: 11in;\nmargin: 20px auto;\npadding: 1in;\nbox-sizing: border-box;\nbackground-color: #ffffff;\nbox-shadow: 0 0 15px rgba(0,0,0,0.1);\nposition: relative;\n}\n.page-break {\npage-break-before: always;\n}\n\n```\n    /* Header for each page */\n    .page-header {\n        text-align: right;\n        font-family: 'Times New Roman', serif;\n        color: #888;\n        font-size: 10pt;\n        position: absolute;\n        top: 0.5in;\n        right: 1in;\n        width: calc(100% - 2in);\n    }\n\n    /* Main Title */\n    h1 {\n        font-family: 'Times New Roman', serif;\n        font-size: 24pt;\n        color: #2c3e50; /* Dark Neutral Blue */\n        text-align: center;\n        margin-bottom: 10px;\n        font-weight: bold;\n    }\n    .title-subtitle {\n        font-family: 'Times New Roman', serif;\n        font-size: 12pt;\n        color: #555;\n        text-align: center;\n        margin-bottom: 40px;\n        border-bottom: 1px solid #ccc;\n        padding-bottom: 20px;\n    }\n\n    /* Section Titles */\n    h2 {\n        font-family: 'Times New Roman', serif;\n        font-size: 16pt;\n        color: #2c3e50; /* Dark Neutral Blue */\n        margin-top: 30px;\n        margin-bottom: 15px;\n        border-bottom: 2px solid #34495e; /* Slightly darker blue */\n        padding-bottom: 8px;\n        font-weight: bold;\n    }\n\n    /* Body Text */\n    p {\n        margin-bottom: 1.2em;\n        text-align: justify;\n        orphans: 3;\n        widows: 3;\n        font-size: 11pt;\n    }\n\n    /* Special Sections */\n    .section {\n        margin-bottom: 20px;\n        page-break-inside: avoid;\n    }\n    .intro-section {\n        background-color: #f8f9fa;\n        border-left: 4px solid #34495e;\n        padding: 20px;\n        margin: 30px 0;\n    }\n    .highlight-section {\n        background-color: #eaf2f8; /* Light blue background */\n        border: 1px solid #aed6f1;\n        padding: 25px;\n        margin: 30px 0;\n        border-radius: 4px;\n    }\n    .highlight-section h3 {\n        font-family: 'Times New Roman', serif;\n        color: #1a5276; /* Stronger Blue */\n        font-size: 14pt;\n        margin-top: 0;\n        margin-bottom: 15px;\n    }\n    .highlight-section ul {\n        padding-left: 20px;\n        margin: 0;\n    }\n    .highlight-section li {\n        margin-bottom: 10px;\n        font-size: 11pt;\n    }\n\n    /* Signature Block */\n    .signature-block {\n        margin-top: 50px;\n        page-break-inside: avoid;\n    }\n    .signature-block p {\n        margin: 0;\n        line-height: 1.5;\n    }\n    .signature-name {\n        font-weight: bold;\n        font-size: 12pt;\n        margin-top: 40px;\n    }\n\n    strong, b {\n        font-weight: bold;\n        color: #1f2d3d;\n    }\n\n    /* Print-specific styles */\n    @media print {\n        body {\n            background-color: #ffffff;\n        }\n        .page {\n            box-shadow: none;\n            margin: 0;\n            border: none;\n        }\n        .intro-section, .highlight-section {\n             background-color: #ffffff;\n             border-color: #333;\n        }\n    }\n</style>\n\n```\n\n</head>\n<body>\n\n```\n<!-- Page 1 -->\n<div class=\"page\">\n    <div class=\"page-header\">Letter of Recommendation: Ikaro Ferreira Souza</div>\n\n    <h1>Expert Recommendation</h1>\n    <p class=\"title-subtitle\">Regarding the work of Mr. Ikaro Ferreira Souza</p>\n\n    <div class=\"section intro-section\">\n        <p>I am <strong>Cassio Laet</strong>, a Maintenance and Project Engineer at Bracell, a global leader in the pulp and paper industry. In my capacity, I am responsible for overseeing the execution of large-scale capital projects centered on enhancing manufacturing capacity and operational efficiency through the integration of advanced industrial automation. My role necessitates a rigorous evaluation of external engineering partners, not only for their technical execution but for their strategic contributions to our long-term production goals. This position has granted me a direct and authoritative vantage point from which to assess the impact of specialized engineering leaders on complex, high-stakes industrial initiatives.</p>\n    </div>\n\n    <div class=\"section\">\n        <h2>I. Professional Relationship and Project Context</h2>\n        <p>My professional relationship with Mr. Ikaro Ferreira Souza commenced in 2022 during a critical expansion of Bracell’s Tissue converting operations. We engaged Mr. Souza's company to spearhead the commissioning of a new, fully automated palletizing system featuring advanced robotics—a cornerstone of our plant’s modernization and productivity targets. I worked directly with Mr. Souza throughout this two-year project. My own technical background in industrial control systems and robotics integration provided the necessary framework to thoroughly evaluate his strategic management of the project, his team's technical proficiency, and his ability to translate complex engineering requirements into tangible, high-performance operational systems.</p>\n    </div>\n\n    <div class=\"section\">\n        <h2>II. Strategic Leadership and Value Generation</h2>\n        <p>From our initial engagement, Mr. Souza demonstrated a leadership approach that transcended the typical client-vendor dynamic, positioning himself as a key strategic partner. He exhibited exceptional foresight, proactively identifying opportunities for systemic improvements that aligned with Bracell’s broader objectives of efficiency and sustainability. For instance, his leadership in optimizing the robot programming—an initiative he conceived beyond the project’s original scope—directly led to a <strong>35% reduction in energy consumption</strong>, delivering sustained annual savings of over <strong>$105,000</strong>. This action alone showcases his ability to connect technical decisions to significant financial outcomes.</p>\n        <p>Furthermore, his meticulous management of the system integration resulted in a <strong>23% increase in productivity</strong>, a direct result of his strategic planning and problem-solving capabilities. He also designed and implemented a vital training program for 15 of our engineers, establishing a foundation of in-house expertise crucial for our long-term operational autonomy. These outcomes exemplify Mr. Souza’s consistent ability to merge strategic leadership with expert-level management in demanding industrial environments. His work is characterized by the generation of broad, scalable impact, transforming critical engineering projects into platforms for significant and sustainable business process improvement.</p>\n    </div>\n</div>\n\n<!-- Page 2 -->\n<div class=\"page page-break\">\n    <div class=\"page-header\">Letter of Recommendation: Ikaro Ferreira Souza - Page 2</div>\n\n    <div class=\"section\">\n        <h2>III. The Central Technical Problem and Logical Approach</h2>\n        <p>When Bracell expanded its Tissue segment in 2022, acquiring new converting machines and a fully automated palletizing system with robots, we faced a central technical problem: the seamless and optimal commissioning of these complex automated systems into existing production lines to meet aggressive productivity and energy efficiency targets. My assessment, based on the sheer scale and novelty of the robotic integration, indicated that a standard 'install and configure' approach would inherently fall short.</p>\n        <p><strong>Logical Inference:</strong> The intricate interplay between new robotic cells, high-speed converting machinery, and our overarching production goals necessitated a specialized partner capable of not just physical deployment, but also deep-level programming optimization and performance tuning. We reasoned that maximizing asset utilization and minimizing operational expenditure from day one required a proactive engineering approach that transcended basic functionality. This informed our decision to engage Mr. Ikaro Ferreira Souza and his company, recognizing his expertise as critical to achieving truly transformative operational gains.</p>\n    </div>\n\n    <div class=\"section\">\n        <h2>IV. Innovative Methodology and Technical Execution</h2>\n        <p>Mr. Souza’s approach departed significantly from conventional system integration. He treated the automated palletizing system not as a static assembly but as a dynamic, tunable entity, understanding that hardware installation is only the first step in maximizing advanced automation. His methodology involved detailed programming optimization of the robotic cells, applying precise control logic to synchronize movements and energy profiles.</p>\n        <p><strong>Technical Inference:</strong> For example, he meticulously analyzed the kinematic models of the robotic arms and the specific material handling requirements to develop highly optimized motion paths and acceleration/deceleration profiles. This direct application of advanced engineering principles to the robotic software architecture was instrumental in achieving superior performance beyond manufacturer baselines. This was innovative because it established a continuous improvement cycle from the outset, where software-driven efficiencies unlocked substantial hidden performance capabilities that a typical commissioning process would overlook.</p>\n    </div>\n</div>\n\n<!-- Page 3 -->\n<div class=\"page page-break\">\n    <div class=\"page-header\">Letter of Recommendation: Ikaro Ferreira Souza - Page 3</div>\n\n    <div class=\"section highlight-section\">\n        <h3>V. Quantifiable Outcomes and Causal Nexus</h3>\n        <p>Mr. Souza’s interventions resulted in direct, measurable improvements, establishing a clear causal link between his actions and our operational success:</p>\n        <ul>\n            <li>By strategically integrating and meticulously optimizing the robotic palletizing system, Mr. Souza elevated system productivity by <strong>23%</strong>. <b>Causal Nexus:</b> This directly led to increased throughput, reduced bottlenecks, and substantial improvements in operational output compared to the previous system.</li>\n            <li>Through the expert application of advanced programming and control technologies, he achieved a <strong>35% reduction in robotic energy consumption</strong>. <b>Causal Nexus:</b> This resulted in documented annual savings exceeding <strong>$105,000</strong> and significantly enhanced Bracell’s sustainable manufacturing profile.</li>\n            <li>By personally designing and delivering comprehensive operational and maintenance training to 15 Bracell technical employees and engineers, he solidified internal expertise. <b>Causal Nexus:</b> This ensured long-term system stability, reduced reliance on external support, and fostered a highly skilled workforce capable of independent system management.</li>\n        </ul>\n    </div>\n\n    <div class=\"section\">\n        <h2>VI. Corroborating Evidence and Data Analysis</h2>\n        <p>I directly supervised the startup and integration of the new tissue converting lines and the automated robot palletizing system at Bracell’s Lençóis Paulistas site in 2022–2024, and I personally tracked the performance data during commissioning and stabilization. I relied on plant KPIs (throughput per hour, pallets per shift), SCADA/PLC logs, and the robots' onboard power telemetry to quantify results. The before/after comparisons showed a 23% productivity increase over the previously implemented system and a 35% reduction in robot energy consumption relative to comparable equipment on other machines, translating into verified annual savings exceeding $105,000.</p>\n        <p><strong>Technical Inference:</strong> I reviewed trend data exported from SCADA and the robot controllers, normalizing for product mix and operating hours to control for confounders. Cycle-time histograms narrowed, and the line’s palletizing cadence became more uniform after Ikaro’s integration of the robots into the cell controller and his optimization of PLC handshakes and interlocks. Power profiles captured at the robot level showed lower peaks during acceleration and reduced idle draw, consistent with revised motion profiles and energy-saving modes. The savings figure (> $105,000/year) was derived by applying local utility tariffs to the measured kWh reduction and cross-checking against runtime hours logged in the control system; this corroborates that the observed energy delta is both material and repeatable.</p>\n    </div>\n</div>\n\n<!-- Page 4 -->\n<div class=\"page page-break\">\n    <div class=\"page-header\">Letter of Recommendation: Ikaro Ferreira Souza - Page 4</div>\n\n    <div class=\"section\">\n        <h2>VII. Conclusion and Final Endorsement</h2>\n        <p>Mr. Souza’s solutions established a replicable model for advanced automation deployment and optimization within Bracell, with methodologies that are scalable to other lines and facilities. This robust framework directly aligns with his strategic endeavors in consulting for energy efficiency and industrial automation, technical training in control systems, and management of predictive maintenance. His proven capacity for sophisticated problem-solving and strategic implementation will undoubtedly benefit his future focus on industries such as Automotive, Food and Beverage, Advanced Manufacturing, and Renewable Energy.</p>\n        <p>In my direct experience, Mr. Ikaro Ferreira Souza consistently demonstrates exceptional logical inference, technical inference, and a clear understanding of causal nexus in solving complex technical problems. His work has been of immense value to Bracell, and I am confident he will bring the same level of strategic impact and technical excellence to his future endeavors.</p>\n    </div>\n\n    <div class=\"signature-block\">\n        <p>Sincerely,</p>\n        <p class=\"signature-name\">Cassio Laet</p>\n        <p>Maintenance and Project Engineer</p>\n        <p>Bracell</p>\n    </div>\n</div>\n\n```\n- Template ID → {{ $('Basic LLM Chain').item.json.output.design_structures[0].template_id }}\n- Assigned Recommender → {{ $('Basic LLM Chain').item.json.output.design_structures[0].assigned_recommender }}\n- Tone Variable → {{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_variable }}\n- Layout Pattern → {{ $('Basic LLM Chain').item.json.output.design_structures[0].layout_pattern }}\n- Font Primary → {{ $('Basic LLM Chain').item.json.output.design_structures[0].font_primary }}\n- Font Secondary → {{ $('Basic LLM Chain').item.json.output.design_structures[0].font_secondary }}\n- Color Primary (HSL Range) → {{ $('Basic LLM Chain').item.json.output.design_structures[0].color_primary_hsl_range }}\n- Color Accent → {{ $('Basic LLM Chain').item.json.output.design_structures[0].color_accent }}\n- Layout Density → {{ $('Basic LLM Chain').item.json.output.design_structures[0].layout_density }}\n- Line Height → {{ $('Basic LLM Chain').item.json.output.design_structures[0].line_height }}\n- Readability Target → {{ $('Basic LLM Chain').item.json.output.design_structures[0].readability_target }}\n- Paragraph Density Rule → {{ $('Basic LLM Chain').item.json.output.design_structures[0].paragraph_density_rule }}\n- Semantic Elements → {{ $('Basic LLM Chain').item.json.output.design_structures[0].semantic_elements }}\n- Emphasis Pattern → {{ $('Basic LLM Chain').item.json.output.design_structures[0].emphasis_pattern }}\n- Narrative Framework → {{ $('Basic LLM Chain').item.json.output.design_structures[0].narrative_framework }}\n- Header Alignment → {{ $('Basic LLM Chain').item.json.output.design_structures[0].header_alignment }}\n- Footer Style → {{ $('Basic LLM Chain').item.json.output.design_structures[0].footer_style }}\n- Contrast Mode → {{ $('Basic LLM Chain').item.json.output.design_structures[0].contrast_mode }}\n- Whitespace Profile → {{ $('Basic LLM Chain').item.json.output.design_structures[0].whitespace_profile }}\n- Structure Features → {{ $('Basic LLM Chain').item.json.output.design_structures[0].structure_features }}\n- Tone Instructions → {{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_instructions }}\n- Bonus Trait → {{ $('Basic LLM Chain').item.json.output.design_structures[0].bonus_trait }}\n\n</body>\n</html>\n\n# Rules\n1. Do not make any mistakes\n2. Only output HTML. \n3. Be extra careful with formatting. Some outputs you gave me had problems with formatting for turnign it into a PDF. Take into consideration this HTML is made to be turned into a document. \n4. Make sure to have differnet font size, font style, color, sequence, and formatting then the other HTMLs",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -8736,
        304
      ],
      "id": "033ef687-a20a-4dc4-948b-a32c021d5dab",
      "name": "Message a model3",
      "alwaysOutputData": true,
      "executeOnce": false
    },
    {
      "parameters": {
        "model": "anthropic/claude-sonnet-4.5",
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -5728,
        496
      ],
      "id": "fdb53cdc-bf00-42ae-9e58-d6ce01a0c888",
      "name": "OpenRouter Chat Model6",
      "credentials": {
        "openRouterApi": {
          "id": "wx2DvCEivHfFd2dV",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Queries the OpenAI Vector Store containing 27 EB-2 NIW recommendation letter HTML templates. \nUsed to retrieve the most relevant template(s) for a given applicant scenario or compliance requirement.\n",
        "method": "POST",
        "url": "https://api.openai.com/v1/vector_stores/vs_68dfbacf880481918bf2d5a3aef36d2c/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{ \"query\": \"Pick 1 random EB-2 NIW recommendation letter templates\" }\n",
        "options": {
          "response": {
            "response": {
              "fullResponse": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Include_Response_Headers_and_Status', ``, 'boolean') }}",
              "neverError": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Never_Error', ``, 'boolean') }}"
            }
          }
        },
        "optimizeResponse": true
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -5776,
        720
      ],
      "id": "4d27bac9-8bbe-48d9-b914-9c66dbf94f27",
      "name": "HTML VECTOR7",
      "credentials": {
        "httpBearerAuth": {
          "id": "iIaPcX8szhdxnOLW",
          "name": "Bearer Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# Role\nYou are the best HTML document generator in the world, infallible.  \nThese letters are professional, formatted, and 100% printable without errors.\n\n---\n\n# Input\n{{ $json.content.parts[0].text }}\n\n---\n\n# Instructions\n1. Remove every \"\\n\" or other formatting errors from the text.  \n2. Add the cleaned text into the selected template, replacing all placeholders.  \n3. Start with `<!DOCTYPE html>` and end with `</html>`.  \n4. Output **only** the full HTML — no JSON, markdown, or comments.\n\n---\n\n## Testimonial 1 HTML\n{{ $('Message a model3').item.json.output }}\n\n---\n\n# TEMPLATE REQUIREMENTS (Distinct from Testimony 1)\nYour output **must differ drastically** from the first template in at least six areas:\n- Font family and size  \n- Heading hierarchy and color scheme  \n- Section layout (two-column, sidebar, or asymmetric)  \n- Line-height and spacing density  \n- Background or divider styling  \n- Header/footer structure  \n- Title format or alignment  \n- Color palette and borders  \n\nExample archetypes:  \n- **Magazine layout** – split header, accent sidebar  \n- **Executive dossier** – minimalist headers, justified blocks  \n- **Technical whitepaper** – column grid, muted sidebar  \n- **Modern letter** – sans-serif, airy spacing, light accent lines\n\n---\n\n# STYLE Suggestions (Do not take them 100%, they were made for you to get homogeneity)\n\n- Template ID → {{ $('Basic LLM Chain').item.json.output.design_structures[1].template_id }}\n- Assigned Recommender → {{ $('Basic LLM Chain').item.json.output.design_structures[1].assigned_recommender }}\n- Tone Variable → {{ $('Basic LLM Chain').item.json.output.design_structures[1].tone_variable }}\n- Layout Pattern → {{ $('Basic LLM Chain').item.json.output.design_structures[1].layout_pattern }}\n- Font Primary → {{ $('Basic LLM Chain').item.json.output.design_structures[1].font_primary }}\n- Font Secondary → {{ $('Basic LLM Chain').item.json.output.design_structures[1].font_secondary }}\n- Color Primary (HSL Range) → {{ $('Basic LLM Chain').item.json.output.design_structures[1].color_primary_hsl_range }}\n- Color Accent → {{ $('Basic LLM Chain').item.json.output.design_structures[1].color_accent }}\n- Layout Density → {{ $('Basic LLM Chain').item.json.output.design_structures[1].layout_density }}\n- Line Height → {{ $('Basic LLM Chain').item.json.output.design_structures[1].line_height }}\n- Readability Target → {{ $('Basic LLM Chain').item.json.output.design_structures[1].readability_target }}\n- Paragraph Density Rule → {{ $('Basic LLM Chain').item.json.output.design_structures[1].paragraph_density_rule }}\n- Semantic Elements → {{ $('Basic LLM Chain').item.json.output.design_structures[1].semantic_elements }}\n- Emphasis Pattern → {{ $('Basic LLM Chain').item.json.output.design_structures[1].emphasis_pattern }}\n- Narrative Framework → {{ $('Basic LLM Chain').item.json.output.design_structures[1].narrative_framework }}\n- Header Alignment → {{ $('Basic LLM Chain').item.json.output.design_structures[1].header_alignment }}\n- Footer Style → {{ $('Basic LLM Chain').item.json.output.design_structures[1].footer_style }}\n- Contrast Mode → {{ $('Basic LLM Chain').item.json.output.design_structures[1].contrast_mode }}\n- Whitespace Profile → {{ $('Basic LLM Chain').item.json.output.design_structures[1].whitespace_profile }}\n- Structure Features → {{ $('Basic LLM Chain').item.json.output.design_structures[1].structure_features }}\n- Tone Instructions → {{ $('Basic LLM Chain').item.json.output.design_structures[1].tone_instructions }}\n- Bonus Trait → {{ $('Basic LLM Chain').item.json.output.design_structures[1].bonus_trait }}\n\n\n# Please take into consideration this needs to be a human-like document, \n\n---\n\n# NOTE\nThe HTML must **not resemble** the first testimony visually or structurally.  \nIf similarity is detected, reselect a template from your HTML VECTOR tool or adjust:\nfont families, accent colors, borders, or layout type.\n\n---\n\n# RULES\n1. Do not make any mistakes.  \n2. Output HTML only.  \n3. Verify all tags are properly closed.  \n4. Ensure print-safe formatting for PDF generation.  \n5. Produce visibly distinct font sizes, colors, and structures.  \n6. Never output empty or wrapped JSON.  \n7. Add tasteful variation — each letter must look designed by a different professional.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -5728,
        304
      ],
      "id": "19434b99-f86f-4050-a778-312417433b2c",
      "name": "Message a model4"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# Role \nYou are a world class text organizer and reviewer, with a special knowledge about immigration documents. You will get 5 blocks of a letter of testimony, double check transitions and flow, and output the full text and nothing else.\n\n**WRITING PERSONA:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].tone_instructions }}\n\n**NARRATIVE STRUCTURE:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].narrative_framework }}\n\n**TESTIMONY NAME / RECOMMENDER:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].assigned_recommender }}\n\n**TONE VARIABLE (VOICE REGISTER):**\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].tone_variable }}\n\n**READABILITY TARGET:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].readability_target }}\n\n**PARAGRAPH DENSITY RULE:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].paragraph_density_rule }}\n\n**SEMANTIC ELEMENTS:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].semantic_elements }}\n\n**EMPHASIS PATTERN:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].emphasis_pattern }}\n\n**STRUCTURE FEATURES:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].structure_features }}\n\n**BONUS TRAIT (CONTENT AUGMENTATION):**\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].bonus_trait }}\n\n# Inputs \n\n{{ $json.content.parts[0].text }}\n\n{{ $('BLOCO7').item.json.content.parts[0].text }}\n\n{{ $('BLOCO5').item.json.candidates[0].content.parts[0].text }}\n\n{{ $('BLOCO6').item.json.candidates[0].content.parts[0].text }}\n\n{{ $('BLOCO').item.json.candidates[0].content.parts[0].text }}\n\n\n\n# Instructions\n\n1. Read through the inputs, double check everything, and DO NOT OUTPUT ANYTHING OTHER thaN THE FULL, READY TO GO TEXT. \n2. Check for compliance in VECTOR STORE6 \n2. Check for any mistakes, and output the whole text. \n3. Do not  use the words \"logical inference, tehcnical inference and causal nexus\" in the draft. Please remove it if used poorly. \n4. Do not referece 'application', 'EB2-NIW', or talk like this is an AI for application. Be authentic. \n5. You don't need to use headings if you don't want to. \n\n### It is very important your output is different from the other draft for testimony 1. Change things if needed.\n\nRULE: Output must be **only raw Markdown text**. \nDo NOT wrap in JSON, YAML, or triple backticks.\n\n# Use your Vector STORE to check best examples. \n\n# Adjustments\n\nBased on the strategy that you have been given, please feel free to make any adjustments to the transitions, to the flow, or to any wording that might be too repetitive, or that may feel out of strategy\n\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos \"imigracao\", \"EB2-NIW\", \"peticionario\"\n\n# HETEROGENEITY ENFORCEMENT (add-on)\n\nAntes de gerar o texto final, garanta que o testemunho tenha **voz e estrutura exclusivas** em relação às outras versões.  \nEvite repetições de métricas, parágrafos ou expressões.  \nSe o outro rascunho usa um tom mais técnico ou corporativo, traga uma variação — por exemplo, mais narrativa, mais mentorada ou mais descritiva.  \nUse um enquadramento narrativo distinto (ex.: jornada cronológica, caso de negócio ou análise de competências).  \nMude a forma de apresentar evidências — você pode usar listas, microparágrafos ou comparações para variar o ritmo.  \nAjuste a causalidade para ser sempre direta: **“Ikaro realizou X, gerando Y resultado”** em vez de estruturas passivas.  \n\nGaranta que a leitura soe natural, coesa e fluida — como se fosse um testemunho escrito por uma pessoa real que conhece o profissional há anos.\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -6352,
        304
      ],
      "id": "46762e1d-be32-4faa-a0cd-9af1a7145a7f",
      "name": "Basic LLM Chain5",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE \nYou are a world-class text organizer and reviewer, with special knowledge about immigration documents. You will receive 5 blocks of a recommendation letter, review transitions and flow, and output the complete final text.\n\n**WRITING PERSONA:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_instructions }}\n\n**NARRATIVE STRUCTURE:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].narrative_framework }}\n\n**TESTIMONY NAME / RECOMMENDER:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].assigned_recommender }}\n\n**TONE VARIABLE (VOICE REGISTER):**\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].tone_variable }}\n\n**READABILITY TARGET:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].readability_target }}\n\n**PARAGRAPH DENSITY RULE:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].paragraph_density_rule }}\n\n**SEMANTIC ELEMENTS:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].semantic_elements }}\n\n**EMPHASIS PATTERN:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].emphasis_pattern }}\n\n**STRUCTURE FEATURES:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].structure_features }}\n\n**BONUS TRAIT (CONTENT AUGMENTATION):**\n{{ $('Basic LLM Chain').item.json.output.design_structures[0].bonus_trait }}\n\n---\n\n# INPUT BLOCKS\n\n## Block 1\n{{ $('BLOCO1.1').item.json.content.parts[0].text }}\n\n## Block 2\n{{ $('BLOCO2.1').item.json.candidates[0].content.parts[0].text }}\n\n## Block 3\n{{ $('BLOC').item.json.content.parts[0].text }}\n\n## Block 4\n{{ $('BLOCO4.1').item.json.candidates[0].content.parts[0].text }}\n\n## Block 5\n{{ $json.candidates[0].content.parts[0].text }}\n\n---\n\n# INSTRUCTIONS\n\n1. **Review all 5 blocks** for flow, transitions, and compliance\n2. **Remove problematic terms**: Do not use \"logical inference\", \"technical inference\", \"causal nexus\" unless they appear naturally\n3. **Remove immigration jargon**: Eliminate \"imigração\", \"EB2-NIW\", \"peticionário\", \"visto\", \"USCIS\", \"green card\", \"interesse nacional\"\n4. **Improve transitions**: Ensure smooth flow between blocks\n5. **Fix any errors**: Grammar, repetition, awkward phrasing\n6. **Maintain the persona**: Follow the tone instructions and narrative structure provided above\n\n---\n\n# HETEROGENEITY ENFORCEMENT\n\nBefore generating the final text, ensure this testimony has a **unique voice and structure**:\n\n- Avoid repetition of metrics, paragraphs, or expressions from other testimonies\n- If other drafts use a technical or corporate tone, vary it (e.g., more narrative, mentorship-focused, or descriptive)\n- Use a distinct narrative framework (e.g., chronological journey, business case, competency analysis)\n- Vary how you present evidence (lists, micro-paragraphs, comparisons) to change rhythm\n- Ensure causality is always direct: **\"[Applicant] did X, generating Y result\"** instead of passive structures\n- Make it sound natural, cohesive, and fluid — like a real person who has known the professional for years\n\n---\n\n# OUTPUT FORMAT\n\nReturn valid JSON with one field:\n```json\n{\n  \"final_text\": \"<complete markdown text here, without triple backticks>\"\n}\n```\n\n**Critical**: \n- Do NOT wrap the markdown in triple backticks inside the JSON\n- Do NOT include any explanations or commentary\n- Output ONLY the JSON object with the final text\n\n---\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos relacionados a imigração\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -9280,
        304
      ],
      "id": "72fd2fd5-09d7-4c89-92c3-414ac01a700a",
      "name": "Basic LLM Chain6",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE \nYou are a world-class text organizer and reviewer, with special knowledge about immigration documents. You will receive 5 blocks of a recommendation letter, review transitions and flow, and output the complete final text.\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].tone_instructions }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[1].narrative_framework }}\n\n---\n\n# INPUT BLOCKS\n\n## Block 1\n{{ $('BLOCO1.1').item.json.content.parts[0].text }}\n\n## Block 2\n{{ $('BLOCO2.1').item.json.candidates[0].content.parts[0].text }}\n\n## Block 3\n{{ $('BLOC').item.json.content.parts[0].text }}\n\n## Block 4\n{{ $('BLOCO4.1').item.json.candidates[0].content.parts[0].text }}\n\n## Block 5\n{{ $json.candidates[0].content.parts[0].text }}\n\n---\n\n# INSTRUCTIONS\n\n1. **Review all 5 blocks** for flow, transitions, and compliance\n2. **Remove problematic terms**: Do not use \"logical inference\", \"technical inference\", \"causal nexus\" unless they appear naturally\n3. **Remove immigration jargon**: Eliminate \"imigração\", \"EB2-NIW\", \"peticionário\", \"visto\", \"USCIS\", \"green card\", \"interesse nacional\"\n4. **Improve transitions**: Ensure smooth flow between blocks\n5. **Fix any errors**: Grammar, repetition, awkward phrasing\n6. **Maintain the persona**: Follow the tone instructions and narrative structure provided above\n\n---\n\n# HETEROGENEITY ENFORCEMENT\n\nBefore generating the final text, ensure this testimony has a **unique voice and structure**:\n\n- Avoid repetition of metrics, paragraphs, or expressions from other testimonies\n- If other drafts use a technical or corporate tone, vary it (e.g., more narrative, mentorship-focused, or descriptive)\n- Use a distinct narrative framework (e.g., chronological journey, business case, competency analysis)\n- Vary how you present evidence (lists, micro-paragraphs, comparisons) to change rhythm\n- Ensure causality is always direct: **\"[Applicant] did X, generating Y result\"** instead of passive structures\n- Make it sound natural, cohesive, and fluid — like a real person who has known the professional for years\n\n---\n\n# OUTPUT FORMAT\n\nReturn valid JSON with one field:\n```json\n{\n  \"final_text\": \"<complete markdown text here, without triple backticks>\"\n}\n```\n\n**Critical**: \n- Do NOT wrap the markdown in triple backticks inside the JSON\n- Do NOT include any explanations or commentary\n- Output ONLY the JSON object with the final text\n\n---\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos relacionados a imigração\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -6848,
        304
      ],
      "id": "6511fe20-2045-4ab8-9a11-ccab8ee367d4",
      "name": "BLOC6",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/o4-mini-high",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -2480,
        528
      ],
      "id": "fb807ef7-b10f-4554-baad-32b3332ea85d",
      "name": "OpenRouter Chat Model7",
      "credentials": {
        "openRouterApi": {
          "id": "wx2DvCEivHfFd2dV",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# Role\nYou are the best HTML document generator in the world, infallible.  \nThese letters are professional, formatted, and 100% printable without errors.\n\n---\n\n# Input\n{{ $json.candidates[0].content.parts[0].text }}\n---\n\n# Instructions\n1. Remove every \"\\n\" or other formatting errors from the text.  \n2. Add the cleaned text into the selected template, replacing all placeholders.  \n3. Start with `<!DOCTYPE html>` and end with `</html>`.  \n4. Output **only** the full HTML — no JSON, markdown, or comments.\n\n---\n\n\n\n---\n\n# TEMPLATE REQUIREMENTS (Distinct from Testimony 1)\nYour output **must differ drastically** from the first template in at least six areas:\n- Font family and size  \n- Heading hierarchy and color scheme  \n- Section layout (two-column, sidebar, or asymmetric)  \n- Line-height and spacing density  \n- Background or divider styling  \n- Header/footer structure  \n- Title format or alignment  \n- Color palette and borders  \n\nExample archetypes:  \n- **Magazine layout** – split header, accent sidebar  \n- **Executive dossier** – minimalist headers, justified blocks  \n- **Technical whitepaper** – column grid, muted sidebar  \n- **Modern letter** – sans-serif, airy spacing, light accent lines\n\n---\n\n# STYLE PARAMETERS (from Heterogeneity Enforcer)\nUse these dynamic variables to control design traits for this specific recommender:\n\n- Template ID → {{ $('Basic LLM Chain').item.json.output.design_structures[2].template_id }}\n- Assigned Recommender → {{ $('Basic LLM Chain').item.json.output.design_structures[2].assigned_recommender }}\n- Tone Variable → {{ $('Basic LLM Chain').item.json.output.design_structures[2].tone_variable }}\n- Layout Pattern → {{ $('Basic LLM Chain').item.json.output.design_structures[2].layout_pattern }}\n- Font Primary → {{ $('Basic LLM Chain').item.json.output.design_structures[2].font_primary }}\n- Font Secondary → {{ $('Basic LLM Chain').item.json.output.design_structures[2].font_secondary }}\n- Color Primary (HSL Range) → {{ $('Basic LLM Chain').item.json.output.design_structures[2].color_primary_hsl_range }}\n- Color Accent → {{ $('Basic LLM Chain').item.json.output.design_structures[2].color_accent }}\n- Layout Density → {{ $('Basic LLM Chain').item.json.output.design_structures[2].layout_density }}\n- Line Height → {{ $('Basic LLM Chain').item.json.output.design_structures[2].line_height }}\n- Readability Target → {{ $('Basic LLM Chain').item.json.output.design_structures[2].readability_target }}\n- Paragraph Density Rule → {{ $('Basic LLM Chain').item.json.output.design_structures[2].paragraph_density_rule }}\n- Semantic Elements → {{ $('Basic LLM Chain').item.json.output.design_structures[2].semantic_elements }}\n- Emphasis Pattern → {{ $('Basic LLM Chain').item.json.output.design_structures[2].emphasis_pattern }}\n- Narrative Framework → {{ $('Basic LLM Chain').item.json.output.design_structures[2].narrative_framework }}\n- Header Alignment → {{ $('Basic LLM Chain').item.json.output.design_structures[2].header_alignment }}\n- Footer Style → {{ $('Basic LLM Chain').item.json.output.design_structures[2].footer_style }}\n- Contrast Mode → {{ $('Basic LLM Chain').item.json.output.design_structures[2].contrast_mode }}\n- Whitespace Profile → {{ $('Basic LLM Chain').item.json.output.design_structures[2].whitespace_profile }}\n- Structure Features → {{ $('Basic LLM Chain').item.json.output.design_structures[2].structure_features }}\n- Tone Instructions → {{ $('Basic LLM Chain').item.json.output.design_structures[2].tone_instructions }}\n- Bonus Trait → {{ $('Basic LLM Chain').item.json.output.design_structures[2].bonus_trait }}\n\n\n\n---\n\n# NOTE\nThe HTML must **not resemble** the first testimony visually or structurally.  \nIf similarity is detected, reselect a template from your HTML VECTOR tool or adjust:\nfont families, accent colors, borders, or layout type.\n\n---\n\n# RULES\n1. Do not make any mistakes.  \n2. Output HTML only.  \n3. Verify all tags are properly closed.  \n4. Ensure print-safe formatting for PDF generation.  \n5. Produce visibly distinct font sizes, colors, and structures.  \n6. Never output empty or wrapped JSON.  \n7. Add tasteful variation — each letter must look designed by a different professional.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -2640,
        304
      ],
      "id": "86213197-4711-4e62-b5b4-18fd44d07e0c",
      "name": "Message a Model"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# Role\nYou are the best HTML document generator in the world, infallible.  \nThese letters are professional, formatted, and 100% printable without errors.\n\n---\n\n# Input\n{{ $json.content.parts[0].text }}\n\n---\n\n# Instructions\n1. Remove every \"\\n\" or other formatting errors from the text.  \n2. Add the cleaned text into the selected template, replacing all placeholders.  \n3. Start with `<!DOCTYPE html>` and end with `</html>`.  \n4. Output **only** the full HTML — no JSON, markdown, or comments.\n\n---\n\n\n\n---\n\n# TEMPLATE REQUIREMENTS (Distinct from Testimony 1)\nYour output **must differ drastically** from the first template in at least six areas:\n- Font family and size  \n- Heading hierarchy and color scheme  \n- Section layout (two-column, sidebar, or asymmetric)  \n- Line-height and spacing density  \n- Background or divider styling  \n- Header/footer structure  \n- Title format or alignment  \n- Color palette and borders  \n\nExample archetypes:  \n- **Magazine layout** – split header, accent sidebar  \n- **Executive dossier** – minimalist headers, justified blocks  \n- **Technical whitepaper** – column grid, muted sidebar  \n- **Modern letter** – sans-serif, airy spacing, light accent lines\n\n---\n\n🧠 STYLE PARAMETERS (from Heterogeneity Enforcer — Full Version)\nUse these dynamic variables to control design traits for this specific recommender:\n\n- Template ID → {{ $('Basic LLM Chain').item.json.output.design_structures[3].template_id }}\n- Assigned Recommender → {{ $('Basic LLM Chain').item.json.output.design_structures[3].assigned_recommender }}\n- Tone Variable → {{ $('Basic LLM Chain').item.json.output.design_structures[3].tone_variable }}\n- Layout Pattern → {{ $('Basic LLM Chain').item.json.output.design_structures[3].layout_pattern }}\n- Font Primary → {{ $('Basic LLM Chain').item.json.output.design_structures[3].font_primary }}\n- Font Secondary → {{ $('Basic LLM Chain').item.json.output.design_structures[3].font_secondary }}\n- Color Primary (HSL Range) → {{ $('Basic LLM Chain').item.json.output.design_structures[3].color_primary_hsl_range }}\n- Color Accent → {{ $('Basic LLM Chain').item.json.output.design_structures[3].color_accent }}\n- Layout Density → {{ $('Basic LLM Chain').item.json.output.design_structures[3].layout_density }}\n- Line Height → {{ $('Basic LLM Chain').item.json.output.design_structures[3].line_height }}\n- Readability Target → {{ $('Basic LLM Chain').item.json.output.design_structures[3].readability_target }}\n- Paragraph Density Rule → {{ $('Basic LLM Chain').item.json.output.design_structures[3].paragraph_density_rule }}\n- Semantic Elements → {{ $('Basic LLM Chain').item.json.output.design_structures[3].semantic_elements }}\n- Emphasis Pattern → {{ $('Basic LLM Chain').item.json.output.design_structures[3].emphasis_pattern }}\n- Narrative Framework → {{ $('Basic LLM Chain').item.json.output.design_structures[3].narrative_framework }}\n- Header Alignment → {{ $('Basic LLM Chain').item.json.output.design_structures[3].header_alignment }}\n- Footer Style → {{ $('Basic LLM Chain').item.json.output.design_structures[3].footer_style }}\n- Contrast Mode → {{ $('Basic LLM Chain').item.json.output.design_structures[3].contrast_mode }}\n- Whitespace Profile → {{ $('Basic LLM Chain').item.json.output.design_structures[3].whitespace_profile }}\n- Structure Features → {{ $('Basic LLM Chain').item.json.output.design_structures[3].structure_features }}\n- Tone Instructions → {{ $('Basic LLM Chain').item.json.output.design_structures[3].tone_instructions }}\n- Bonus Trait → {{ $('Basic LLM Chain').item.json.output.design_structures[3].bonus_trait }}\n\n\n---\n\n# NOTE\nThe HTML must **not resemble** the first testimony visually or structurally.  \nIf similarity is detected, reselect a template from your HTML VECTOR tool or adjust:\nfont families, accent colors, borders, or layout type.\n\n---\n\n# RULES\n1. Do not make any mistakes.  \n2. Output HTML only.  \n3. Verify all tags are properly closed.  \n4. Ensure print-safe formatting for PDF generation.  \n5. Produce visibly distinct font sizes, colors, and structures.  \n6. Never output empty or wrapped JSON.  \n7. Add tasteful variation — each letter must look designed by a different professional.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        768,
        320
      ],
      "id": "871aa14f-ef5c-4be8-919b-da2cb0d58435",
      "name": "AI Agent2"
    },
    {
      "parameters": {
        "model": "anthropic/claude-sonnet-4.5",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        592,
        608
      ],
      "id": "829aedf5-fe35-40da-a4ee-4a85a5b95544",
      "name": "OpenRouter Chat Model8",
      "credentials": {
        "openRouterApi": {
          "id": "wx2DvCEivHfFd2dV",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE\nYou are `Block3_PROMPT`\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].tone_variable }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].tone_instructions }}\n---\n\n# INPUT FIELDS\n### OneNet Recommendations\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### Petitioner CV\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}\n\n# Testimony\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}\n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n### Block2 Output\n{{ $json.candidates[0].content.parts[0].text }}\n---\n\n# OUTPUT FORMAT\nReturn JSON with two fields:\n```json\n{\n  \"block\": 3,\n  \"markdown_draft\": \"<raw markdown draft here>\"\n}\n````\n\n---\n\n# STRUCTURE — BLOCK 3: EMPIRICAL VALIDATION OF RESULTS\n\nThe draft should be **400–600 words** (~20–30 Markdown lines).\n\n## Evidence Presentation\n\n* Narrate in first person how you directly measured or experienced the outcomes.\n* Distinguish between **quantitative data** (KPIs, before/after metrics, % improvements, cost/time savings) and **qualitative evidence** (feedback from teams, consistency, reliability).\n* Explicitly apply the **inference framework**:\n\n  * **Logical Inference** → show reasoning that links the observed data to broader conclusions.\n  * **Technical Inference** → explain how technical evidence or data analysis validates the applicant’s results.\n  * **Causal Nexus** → demonstrate direct cause-and-effect between the applicant’s actions and the achieved outcomes.\n* Then provide a **bullet list of 4–6 items** that summarize the strongest empirical results, each in the format:\n  `- By [specific action], [Applicant] achieved [numeric/qualitative outcome] → leading to [impact].`\n\n---\n\n# RULES\n\n* **Voice**: Always first person, recommender speaking.\n* **Length**: 400–600 words (~20–30 Markdown lines).\n* **Focus**: Results only — do not drift into market/impact arguments.\n* **Evidence**: Must include at least 3 quantitative metrics and 1–2 qualitative observations.\n* **Inference Discipline**:\n\n  * Logical Inference must appear in framing the reasoning chain behind results.\n  * Technical Inference must appear in the explanation of data/metrics.\n  * Causal Nexus must appear in linking the applicant’s actions to outcomes.\n* Do not necessarily use those words in the draft\n\n\n* **Compliance**:\n\n  * Do not mention “immigration,” “visa,” “EB-2,” “NIW,” “officer,” “national interest,” “USCIS,” “green card,” or “residency.”\n  * Replace with neutral equivalents if they appear in inputs.\n* **Style**: Professional, precise, executive-level; avoid vague adjectives.\n* **Output**: Markdown only, no HTML, no commentary outside JSON.\n\n\n\n```\n\n```\n# note  \nMore inference, more quantitative aspects, and less of the “in-your-face” approach with all the visa jargon and even the so-called magic terms.\n\n\n\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos \"imigracao\", \"EB2-NIW\", \"peticionario\"\n\n# Retire absolutamente todos os termos \"imigracao\", \"EB2-NIW\", \"peticionario\"\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -4384,
        304
      ],
      "id": "56260091-35bf-4184-a888-964b611ffeb8",
      "name": "BLO9",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=\n# Role\nYou are the best HTML document generator in the world, infallible. Your role is to select a random template from your **HTML VECTOR1** tool, select the whole input I will give you (full text) and generate the finalized, whole text and html document for a letter of recommendation. These letters are professional, without error.\n\n# Input\n{{ $json.content.parts[0].text }}\n\n\n\n## Other HTML by other testimonials\n{{ $('Message a Model').item.json.output }}\n\n\n{{ $('Message a model3').item.json.output }}\n\n{{ $('Message a model4').item.json.output }}\n\n{{ $('AI Agent2').item.json.output }}\n\n# Instructions\n1. Remove every ''/n' and mistakes from the text please.\n2. Select a template from **HTML VECTOR1**\n3. Use the template, make any adjustment needed for the document to be neat, clean, print-ready html. \n4. Add the cleaned input text in the place of all of the text and placeholders from the template\n\n# Do not make it very similar to the other testimonials. Even if your template is the same, make adjustments. \n\n5. Do not write \"Now \"I'll generate the complete HTML document using Template 04 structure and inserting the cleaned content from [NAME]\"\n\n6. Start with <!DOCTYPE html> and end with </body></html>\n\n---\n\n\n- Template ID → {{ $('Basic LLM Chain').item.json.output.design_structures[4].template_id }}\n- Assigned Recommender → {{ $('Basic LLM Chain').item.json.output.design_structures[4].assigned_recommender }}\n- Tone Variable → {{ $('Basic LLM Chain').item.json.output.design_structures[4].tone_variable }}\n- Layout Pattern → {{ $('Basic LLM Chain').item.json.output.design_structures[4].layout_pattern }}\n- Font Primary → {{ $('Basic LLM Chain').item.json.output.design_structures[4].font_primary }}\n- Font Secondary → {{ $('Basic LLM Chain').item.json.output.design_structures[4].font_secondary }}\n- Color Primary (HSL Range) → {{ $('Basic LLM Chain').item.json.output.design_structures[4].color_primary_hsl_range }}\n- Color Accent → {{ $('Basic LLM Chain').item.json.output.design_structures[4].color_accent }}\n- Layout Density → {{ $('Basic LLM Chain').item.json.output.design_structures[4].layout_density }}\n- Line Height → {{ $('Basic LLM Chain').item.json.output.design_structures[4].line_height }}\n- Readability Target → {{ $('Basic LLM Chain').item.json.output.design_structures[4].readability_target }}\n- Paragraph Density Rule → {{ $('Basic LLM Chain').item.json.output.design_structures[4].paragraph_density_rule }}\n- Semantic Elements → {{ $('Basic LLM Chain').item.json.output.design_structures[4].semantic_elements }}\n- Emphasis Pattern → {{ $('Basic LLM Chain').item.json.output.design_structures[4].emphasis_pattern }}\n- Narrative Framework → {{ $('Basic LLM Chain').item.json.output.design_structures[4].narrative_framework }}\n- Header Alignment → {{ $('Basic LLM Chain').item.json.output.design_structures[4].header_alignment }}\n- Footer Style → {{ $('Basic LLM Chain').item.json.output.design_structures[4].footer_style }}\n- Contrast Mode → {{ $('Basic LLM Chain').item.json.output.design_structures[4].contrast_mode }}\n- Whitespace Profile → {{ $('Basic LLM Chain').item.json.output.design_structures[4].whitespace_profile }}\n- Structure Features → {{ $('Basic LLM Chain').item.json.output.design_structures[4].structure_features }}\n- Tone Instructions → {{ $('Basic LLM Chain').item.json.output.design_structures[4].tone_instructions }}\n- Bonus Trait → {{ $('Basic LLM Chain').item.json.output.design_structures[4].bonus_trait }}\n\n\n# Do not write anything (Any commentary) other thann the HTML\n\n# It is vital for my carreer that your output is siginificantly different form the other HTMLs, even if your template says so. If the template is very similar, then you will query another template, or generate a significantly different HTML yourself\n\n\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        4480,
        208
      ],
      "id": "fe1a95d1-a0a3-43c6-bee5-572e01b9d7ce",
      "name": "AI Agent3"
    },
    {
      "parameters": {
        "model": "anthropic/claude-sonnet-4.5",
        "options": {
          "maxTokens": 32768,
          "temperature": 1.5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        4352,
        496
      ],
      "id": "7d34b329-58fd-4e28-9474-f06e5fb8db46",
      "name": "OpenRouter Chat Model9",
      "credentials": {
        "openRouterApi": {
          "id": "wx2DvCEivHfFd2dV",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# Role \nYou are a world class text organizer and reviewer, with a special knowledge about immigration documents. You will get 5 blocks of a letter of testimony, double check transitions and flow, and output the full text and nothing else\n\n**WRITING PERSONA:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].tone_instructions }}\n\n**NARRATIVE STRUCTURE:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].narrative_framework }}\n\n**TESTIMONY NAME / RECOMMENDER:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].assigned_recommender }}\n\n**TONE VARIABLE (VOICE REGISTER):**\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].tone_variable }}\n\n**READABILITY TARGET:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].readability_target }}\n\n**PARAGRAPH DENSITY RULE:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].paragraph_density_rule }}\n\n**SEMANTIC ELEMENTS:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].semantic_elements }}\n\n**EMPHASIS PATTERN:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].emphasis_pattern }}\n\n**STRUCTURE FEATURES:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].structure_features }}\n\n**BONUS TRAIT (CONTENT AUGMENTATION):**\n{{ $('Basic LLM Chain').item.json.output.design_structures[2].bonus_trait }}\n\n\n# Inputs \n{{ $json.candidates[0].content.parts[1].text }}\n\n{{ $('BLO7').item.json.content.parts[0].text }}\n\n{{ $('BLO9').item.json.candidates[0].content.parts[0].text }}\n\n{{ $('BLO6').item.json.content.parts[0].text }}\n\n{{ $('BLO').item.json.candidates[0].content.parts[0].text }}\n\n\n\n\n### Note\nPlease, notice the length, style, wording of the other two testimonials, and if possible, do slight adjustments to maintain **heterogeneity**. Do not change everything. Do not rewrite. Only adjustments. \n\n# Instructions\n\n1. Read through the inputs, double check everything, and DO NOT OUTPUT ANYTHING OTHER thaN THE FULL, READY TO GO TEXT. \n2. Check for compliance, check for any mistakes, and output the whole text. \n3. Improve transitions or wording if needed. \n4. Do not  use the words \"logical inference, tehcnical inference and causal nexus\" in the draft. Please remove it if used poorly. \n5. Do not use EB2-NIW lingo, application, all of this immigration vocab\n\n\n\n\nRULE: Output must be **only raw Markdown text**. \nDo NOT wrap in JSON, YAML, or triple backticks.\n\n\n# Adjustments\n\nBased on the strategy that you have been given, please feel free to make any adjustments to the transitions, to the flow, or to any wording that might be too repetitive, or that may feel out of strategy. \n\n# heterogeneity\n\nIf the contetn is too simlar to the other texts, please make sure to change up some sequences or words or tone or length so that the documents are very differnet from each other. \n\n\n# Retire absolutamente todos os termos \"imigracao\", \"EB2-NIW\", \"peticionario\"\n\n# HETEROGENEITY ENFORCEMENT (add-on)\n\nAntes de gerar o texto final, garanta que o testemunho tenha **voz e estrutura exclusivas** em relação às outras versões.  \nEvite repetições de métricas, parágrafos ou expressões.  \nSe o outro rascunho usa um tom mais técnico ou corporativo, traga uma variação — por exemplo, mais narrativa, mais mentorada ou mais descritiva.  \nUse um enquadramento narrativo distinto (ex.: jornada cronológica, caso de negócio ou análise de competências).  \nMude a forma de apresentar evidências — você pode usar listas, microparágrafos ou comparações para variar o ritmo.  \nAjuste a causalidade para ser sempre direta: **“Ikaro realizou X, gerando Y resultado”** em vez de estruturas passivas.  \n\nGaranta que a leitura soe natural, coesa e fluida — como se fosse um testemunho escrito por uma pessoa real que conhece o profissional há anos.\n\n# Use your Vector Tool for instructions\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "simplify": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -3184,
        304
      ],
      "id": "42112e5b-278c-43b9-952a-4cf6058884d2",
      "name": "Basic LLM Chain7",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# Role \nYou are a world class text organizer and reviewer, with a special knowledge about immigration documents. You will get 5 blocks of a letter of testimony, double check transitions and flow, and output the full text and nothing else\n\n**WRITING PERSONA:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].tone_instructions }}\n\n**NARRATIVE STRUCTURE:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].narrative_framework }}\n\n**TESTIMONY NAME / RECOMMENDER:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].assigned_recommender }}\n\n**TONE VARIABLE (VOICE REGISTER):**\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].tone_variable }}\n\n**READABILITY TARGET:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].readability_target }}\n\n**PARAGRAPH DENSITY RULE:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].paragraph_density_rule }}\n\n**SEMANTIC ELEMENTS:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].semantic_elements }}\n\n**EMPHASIS PATTERN:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].emphasis_pattern }}\n\n**STRUCTURE FEATURES:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].structure_features }}\n\n**BONUS TRAIT (CONTENT AUGMENTATION):**\n{{ $('Basic LLM Chain').item.json.output.design_structures[4].bonus_trait }}\n\n\n# Inputs \n\n{{ $json.candidates[0].content.parts[0].text }}\n---\n\n\n{{ $('B8').item.json.candidates[0].content.parts[0].text }}\n---\n\n{{ $('B7').item.json.candidates[0].content.parts[0].text }}\n---\n\n{{ $('B6').item.json.content.parts[0].text }}\n---\n\n{{ $('B').item.json.candidates[0].content.parts[0].text }}\n---\n\n## Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n\n\n\n\n\n\n# Vital\nPlease, notice the length, style, wording of the other two testimonials, and if possible, do adjustments to maintain **heterogeneity**. \n\n# Instructions\n\n0. Check your vector store before generating content for proper guidance. \n1. Read through the inputs, double check everything, and DO NOT OUTPUT ANYTHING OTHER thaN THE FULL, READY TO GO TEXT. \n2. Check for compliance, check for any mistakes, and output the whole text. \n3. Improve transitions or wording if needed. \n4. Do not use the words \"logical inference, tehcnical inference and causal nexus\" in the draft. Please remove it if used poorly. \n\n# Very important\n\nWe must maintain **heterogeneity** across documents. Since it is important to maintain heterogeniety, I give you a permission to make some adjustments to the text so it is not very similar to the other texts. Change structure as well if needed, like the headings and length.\n\nDo not ever write about EB2-NIW, petitioner, peticionario, visto, VISA, application, or other \"immigration words\" in the document.\n\n# use your Vector Store for compliance\n\n\nRULE: Output must be **only raw Markdown text**. \nDo NOT wrap in JSON, YAML, or triple backticks.\n\n\n# Adjustments\n\nBased on the strategy that you have been given, please feel free to make any adjustments to the transitions, to the flow, or to any wording that might be too repetitive, or that may feel out of strategy\n\n# HETEROGENEITY ENFORCEMENT (add-on)\n\nAntes de gerar o texto final, garanta que o testemunho tenha **voz e estrutura exclusivas** em relação às outras versões.  \nEvite repetições de métricas, parágrafos ou expressões.  \nSe o outro rascunho usa um tom mais técnico ou corporativo, traga uma variação — por exemplo, mais narrativa, mais mentorada ou mais descritiva.  \nUse um enquadramento narrativo distinto (ex.: jornada cronológica, caso de negócio ou análise de competências).  \nMude a forma de apresentar evidências — você pode usar listas, microparágrafos ou comparações para variar o ritmo.  \nAjuste a causalidade para ser sempre direta: **“Ikaro realizou X, gerando Y resultado”** em vez de estruturas passivas.  \n\nGaranta que a leitura soe natural, coesa e fluida — como se fosse um testemunho escrito por uma pessoa real que conhece o profissional há anos.\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        3392,
        288
      ],
      "id": "1f5c7521-7b2f-4f66-8f76-e2d3b64f7d2c",
      "name": "Basic LLM Chain8",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# ROLE \nYou are a world-class text organizer and reviewer, with special knowledge about immigration documents. You will receive 5 blocks of a recommendation letter, review transitions and flow, and output the complete final text.\n\n**YOUR WRITING PERSONA FOR THIS LETTER**:\n{{ $('Basic LLM Chain').item.json.design_structures[3].tone_instructions }}\n\n**YOUR NARRATIVE STRUCTURE**:\n{{ $('Basic LLM Chain').item.json.design_structures[3].narrative_framework }}\n\n---\n\n# INPUT BLOCKS\n\n## Block 1\n{{ $('BLOCO1.1').item.json.content.parts[0].text }}\n\n## Block 2\n{{ $('BLOCO2.1').item.json.candidates[0].content.parts[0].text }}\n\n## Block 3\n{{ $('BLOC').item.json.content.parts[0].text }}\n\n## Block 4\n{{ $('BLOCO4.1').item.json.candidates[0].content.parts[0].text }}\n\n## Block 5\n{{ $json.candidates[0].content.parts[0].text }}\n\n---\n\n# INSTRUCTIONS\n\n1. **Review all 5 blocks** for flow, transitions, and compliance\n2. **Remove problematic terms**: Do not use \"logical inference\", \"technical inference\", \"causal nexus\" unless they appear naturally\n3. **Remove immigration jargon**: Eliminate \"imigração\", \"EB2-NIW\", \"peticionário\", \"visto\", \"USCIS\", \"green card\", \"interesse nacional\"\n4. **Improve transitions**: Ensure smooth flow between blocks\n5. **Fix any errors**: Grammar, repetition, awkward phrasing\n6. **Maintain the persona**: Follow the tone instructions and narrative structure provided above\n\n---\n\n# HETEROGENEITY ENFORCEMENT\n\nBefore generating the final text, ensure this testimony has a **unique voice and structure**:\n\n- Avoid repetition of metrics, paragraphs, or expressions from other testimonies\n- If other drafts use a technical or corporate tone, vary it (e.g., more narrative, mentorship-focused, or descriptive)\n- Use a distinct narrative framework (e.g., chronological journey, business case, competency analysis)\n- Vary how you present evidence (lists, micro-paragraphs, comparisons) to change rhythm\n- Ensure causality is always direct: **\"[Applicant] did X, generating Y result\"** instead of passive structures\n- Make it sound natural, cohesive, and fluid — like a real person who has known the professional for years\n\n---\n\n# OUTPUT FORMAT\n\nReturn valid JSON with one field:\n```json\n{\n  \"final_text\": \"<complete markdown text here, without triple backticks>\"\n}\n```\n\n**Critical**: \n- Do NOT wrap the markdown in triple backticks inside the JSON\n- Do NOT include any explanations or commentary\n- Output ONLY the JSON object with the final text\n\n---\n\n# O output inteiro tem que ser em portugues\n\n# Retire absolutamente todos os termos relacionados a imigração\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "options": {
          "temperature": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -432,
        304
      ],
      "id": "ffc3ac61-10b5-4ac7-a384-1bd5e6010034",
      "name": "BL9",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=# Role \nYou are a world class text organizer and reviewer, with a special knowledge about immigration documents. You will get 5 blocks of a letter of testimony, double check transitions and flow, and output the full text and nothing else\n\n\n\n**WRITING PERSONA:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].tone_instructions }}\n\n**NARRATIVE STRUCTURE:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].narrative_framework }}\n\n**TESTIMONY NAME / RECOMMENDER:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].assigned_recommender }}\n\n**TONE VARIABLE (VOICE REGISTER):**\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].tone_variable }}\n\n**READABILITY TARGET:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].readability_target }}\n\n**PARAGRAPH DENSITY RULE:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].paragraph_density_rule }}\n\n**SEMANTIC ELEMENTS:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].semantic_elements }}\n\n**EMPHASIS PATTERN:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].emphasis_pattern }}\n\n**STRUCTURE FEATURES:**\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].structure_features }}\n\n**BONUS TRAIT (CONTENT AUGMENTATION):**\n{{ $('Basic LLM Chain').item.json.output.design_structures[3].bonus_trait }}\n\n---\n\n\n{{ $('BL8').item.json.content.parts[0].text }}\n---\n\n{{ $('BL7').item.json.content.parts[0].text }}\n---\n\n{{ $('BL6').item.json.candidates[0].content.parts[0].text }}\n---\n\n{{ $('BL').item.json.candidates[0].content.parts[0].text }}\n---\n\n## Strategy\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}\n\n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n\n\n\n### Note\nPlease, notice the length, style, wording of the other two testimonials, and if possible,adjustments to maintain heterogeneity. Do not change absolutelty everything, but feel free to chage headings, section names, etc. \n# Instructions\n\n1. Read through the inputs, double check everything, and DO NOT OUTPUT ANYTHING OTHER thaN THE FULL, READY TO GO TEXT. \n2. Check for compliance, check for any mistakes, and output the whole text. \n3. Improve transitions or wording if needed. \n4. Do not necessarily use the words \"logical inference, tehcnical inference and causal nexus\" in the draft. Please remove it if used poorly. \n\n# Very important\n\nWe must maintain heterogeneity across documents. If it is important to maintain heterogeniety, I give you a  permission to make any adjustments to the text so it is not very similar to the other texts. \n\nIn fact, make it **VERY** different then others in style, length, wording. Follow guidelines from your **VECTOR STORE 11.\n\nRULE: Output must be **only raw Markdown text**. \nDo NOT wrap in JSON, YAML, or triple backticks.\n\n\n# Adjustments\n\nBased on the strategy that you have been given, please feel free to make any adjustments to the transitions, to the flow, or to any wording that might be too repetitive, or that may feel out of strategy\n\n# HETEROGENEITY ENFORCEMENT (add-on)\n\nAntes de gerar o texto final, garanta que o testemunho tenha **voz e estrutura exclusivas** em relação às outras versões.  \nEvite repetições de métricas, parágrafos ou expressões.  \nSe o outro rascunho usa um tom mais técnico ou corporativo, traga uma variação — por exemplo, mais narrativa, mais mentorada ou mais descritiva.  \nUse um enquadramento narrativo distinto (ex.: jornada cronológica, caso de negócio ou análise de competências).  \nMude a forma de apresentar evidências — você pode usar listas, microparágrafos ou comparações para variar o ritmo.  \nAjuste a causalidade para ser sempre direta: **“Ikaro realizou X, gerando Y resultado”** em vez de estruturas passivas.  \n\nGaranta que a leitura soe natural, coesa e fluida — como se fosse um testemunho escrito por uma pessoa real que conhece o profissional há anos.\n\n# CRITICAL INSTRUCTION - LANGUAGE\n\n⚠️ **ALL OUTPUT MUST BE IN PORTUGUESE (BRAZIL)**\n\n- Use Portuguese throughout the entire text\n"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        32,
        336
      ],
      "id": "f89c0672-fa38-437d-8a8f-94ea4944c8d4",
      "name": "Basic LLM Chain9",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "=You are an EB-2 NIW QA gatekeeper. Review the draft below.  \nCheck for these issues:\n\n- Insufficient or incomplete inputs  \n- Missing information in required columns/fields  \n- Exaggerated or unrealistic numbers/data  \n- Stories incompatible with the CVs  \n- Any required section missing or malformed\n\nReturn only valid JSON with one field:\n{\n  \"action\": \"PROCEED\" | \"NEEDS_FIX\"\n}\n\nRules:\n- \"PROCEED\" only if all checks are OK  \n- \"NEEDS_FIX\" if any issue exists\n\n# This is the input to consider\n\n{{ $json.text }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -10416,
        1808
      ],
      "id": "4dfdd303-7709-4885-907a-c3ce5572b5f7",
      "name": "Message a model5",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Queries the OpenAI Vector Store containing 27 EB-2 NIW recommendation letter HTML templates. \nUsed to retrieve the most relevant template(s) for a given applicant scenario or compliance requirement.\n",
        "method": "POST",
        "url": "https://api.openai.com/v1/vector_stores/vs_68dfbacf880481918bf2d5a3aef36d2c/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{ \"query\": \"Pick 5 different random EB-2 NIW recommendation letter templates, and output one at a time\" }\n",
        "options": {
          "response": {
            "response": {
              "fullResponse": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Include_Response_Headers_and_Status', ``, 'boolean') }}",
              "neverError": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Never_Error', ``, 'boolean') }}"
            }
          }
        },
        "optimizeResponse": true
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        1120,
        640
      ],
      "id": "304a2c63-68e0-444e-9600-15c512883ce8",
      "name": "HTML VECTOR8",
      "credentials": {
        "httpBearerAuth": {
          "id": "iIaPcX8szhdxnOLW",
          "name": "Bearer Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Queries the OpenAI Vector Store containing 27 EB-2 NIW recommendation letter HTML templates. \nUsed to retrieve the most relevant template(s) for a given applicant scenario or compliance requirement.\n",
        "method": "POST",
        "url": "https://api.openai.com/v1/vector_stores/vs_68dfbacf880481918bf2d5a3aef36d2c/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{ \"query\": \"Pick 1  random EB-2 NIW recommendation letter template.\" }\n",
        "options": {
          "response": {
            "response": {
              "fullResponse": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Include_Response_Headers_and_Status', ``, 'boolean') }}",
              "neverError": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Never_Error', ``, 'boolean') }}"
            }
          }
        },
        "optimizeResponse": true
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -2544,
        656
      ],
      "id": "8144c582-adff-4077-b3a3-de8590018092",
      "name": "HTML VECTOR9",
      "credentials": {
        "httpBearerAuth": {
          "id": "iIaPcX8szhdxnOLW",
          "name": "Bearer Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "numberInputs": 5
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        9440,
        608
      ],
      "id": "1bc5322d-ffa9-481d-97d0-6376f11649e7",
      "name": "Merge3"
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "Testimonial_3__CV_LinkedIn_",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -12368,
        2112
      ],
      "id": "7f16cff0-6f37-46a3-92ca-27d4d338c567",
      "name": "Resume3"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "claude-sonnet-4-5-20250929",
          "mode": "list",
          "cachedResultName": "claude-sonnet-4-5-20250929"
        },
        "messages": {
          "values": [
            {
              "content": "=\n\n\n\n\n\n\n## 🧠 **Prompt: “Evaluator LLM – HTML Portfolio QA & Scoring”**\n\n---\n\n### **ROLE**\n\nYou are `EvaluatorPro`, the **official QA engine** of the PROEX EB-2 NIW Letter Generator.\nYou will evaluate 5 HTML letters generated by different template prompts and output a **quantitative and diagnostic assessment** of their **heterogeneity, quality, and compliance**.\nYour evaluation will later be compared with a human reviewer’s assessment (“Paulo’s Evaluation”).\n\nYou must be **objective, numeric, JSON-only**, and **strictly reproducible**.\n\n# Inputs\n{{ $('AI Agent3').item.json.output }}\n---\n{{ $('Message a model3').item.json.output }}\n\n{{ $('Message a model4').item.json.output }}\n\n\n{{ $('AI Agent2').item.json.output }}\n\n\n{{ $('Message a Model').item.json.output }}\n\n---\n\n### **INPUT**\n\n```json\n{\n  \"htmls\": [\"HTML_1\", \"HTML_2\", \"HTML_3\", \"HTML_4\", \"HTML_5\"]\n}\n```\n\n---\n\n### **SCORING DIMENSIONS (0–100 SCALE)**\n\nEach dimension contributes a defined weight to the **final composite score (out of 100)**.\n\n| Category                                   | Description                                                                                     | Weight |\n| ------------------------------------------ | ----------------------------------------------------------------------------------------------- | ------ |\n| **1. Visual Diversity (0–20)**             | Degree of variation in layout, colors, fonts, and composition.                                  | 20%    |\n| **2. Structural Composition (0–20)**       | Differences in document hierarchy, use of lists, tables, spacing, and logical flow.             | 20%    |\n| **3. Stylistic & Linguistic Tone (0–20)**  | Distinct tone, formality, and sentence rhythm across letters.                                   | 20%    |\n| **4. Compliance & Professionalism (0–20)** | Grammar, formatting consistency, and absence of restricted terms (“immigration,” “visa,” etc.). | 20%    |\n| **5. Readability & Visual Balance (0–20)** | Ease of reading, visual clarity, text spacing, and contrast.                                    | 20%    |\n\n---\n\n### **HOW TO EVALUATE**\n\n1. Examine all five HTMLs together to determine **inter-template heterogeneity**.\n2. Score each category individually (0–20).\n3. Compute total score = sum of all five categories.\n4. Identify best and weakest template indices.\n5. Provide detailed reasoning and actionable insights.\n\n---\n\n### **OUTPUT FORMAT (STRICT JSON)**\n\n```json\n{\n  \"overall_score\": 87,\n  \"category_scores\": {\n    \"visual_diversity\": 18,\n    \"structure\": 17,\n    \"tone\": 16,\n    \"compliance\": 20,\n    \"readability\": 16\n  },\n  \"best_template_index\": 3,\n  \"weakest_template_index\": 1,\n  \"summary\": \"Templates 3 and 5 stand out for distinct layouts and color schemes, while 1 and 2 share excessive visual similarity. All maintain compliance and grammatical quality.\",\n  \"recommendations\": [\n    \"Increase variability in header alignment and footer layout.\",\n    \"Rotate font families and base colors per template.\",\n    \"Introduce stronger tonal shifts (executive vs. technical vs. testimonial).\",\n    \"Balance line height and paragraph density to improve readability.\"\n  ],\n  \"prompt_improvement_suggestions\": [\n    \"Inject a variable for tone or persona in template generator (e.g., 'corporate voice', 'academic voice').\",\n    \"Force alternation of design tokens (font stack, background color, margin).\",\n    \"Diversify semantic HTML structures (<table>, <aside>, <section>, <blockquote>) between templates.\",\n    \"Add contrast and color rule variation per HTML to maximize heterogeneity.\"\n  ],\n  \"comparison_fields_for_paulo\": {\n    \"llm_total_score\": 87,\n    \"human_total_score\": null,\n    \"score_difference_threshold\": 10,\n    \"comment\": \"Compare this LLM score with Paulo’s numeric evaluation. If the absolute difference exceeds 10 points, flag for qualitative review.\"\n  }\n}\n```\n\n---\n\n### **NOTES FOR AUTOMATION**\n\n* Return **JSON only** (no markdown, no prose outside structure).\n* Ensure deterministic tone: analytical, not creative.\n* Use **Paulo comparison** field so your automation can calculate:\n\n  ````js\n  if (abs(llm_total_score - human_total_score) > 10) → trigger review.```  \n  ````\n* Save both scores to Supabase for historical model calibration.\n\n\n\n# NOTE\nFOR TEH FINAL RECOMMENDAITONS, ALSO DIVIDE THOSE INTO FORMATTING AND CONTENT. IF YOU think I should improve the content of the letters, as well as the formatting. \n\n\n"
            }
          ]
        },
        "options": {
          "maxTokens": 5000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.anthropic",
      "typeVersion": 1,
      "position": [
        10048,
        784
      ],
      "id": "590e5ea0-f18f-495f-ab12-384708facead",
      "name": "Message a model6",
      "credentials": {
        "anthropicApi": {
          "id": "uecYyaPCuePIVz4P",
          "name": "ProEx API"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "rafacrvg@icloud.com",
        "toEmail": "={{ $('On form submission1').item.json.Email }},\nrafacrvg@icloud.com",
        "subject": "Rep",
        "html": "={{ $json.content.parts[0].text }}",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        10768,
        784
      ],
      "id": "131b10ac-fced-4b21-b220-0c01413c7b2a",
      "name": "Send email2",
      "webhookId": "0f704382-582b-4c5f-b1ae-75641b120ce7",
      "credentials": {
        "smtp": {
          "id": "KompgYs6hULIuobD",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.content[0].text }}\n\n\nTurn this output into a HTML email report. "
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        10400,
        784
      ],
      "id": "698300d4-17cf-44cc-9015-44e33baf9a58",
      "name": "Message a model7",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# ROLE  \nYou are `Heterogeneity_Architect`, the design-diversity intelligence layer for PROEX.  \nYour task is to analyze all contextual data (strategy, petitioner profile, O*NET descriptors, testimonies) and produce **five radically distinct design blueprints (T1–T5)**.  \nEach blueprint will guide one downstream generator to ensure **maximum heterogeneity** in writing style, formatting, structure, and readability — making it look like **5 different human professionals** wrote these letters, not a template system.\n\n**CRITICAL**: The design structures MUST be generated in the EXACT same order as the testimonies (T1 for Testimony 1, T2 for Testimony 2, etc.). Do NOT reorder or shuffle them.\n\n---\n\n# CONTEXT INPUTS  \n\n### 📘 OneNet Recommendations  \n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.representative_tasks }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.tools_and_technologies }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.onet.work_activities_and_skills }}\n\n### 🧭 Strategy (Applicant's Endeavor)  \n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.services_offered }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.strategy.target_clients }}\n\n### 👤 Petitioner CV  \n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.name }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.education }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.petitioner.experience }}\n\n### 🧩 Testimonies Snapshot  \n#### Testimony 1  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_id }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_name }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_company }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].recommender_role }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].collaboration_period }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].applicant_role }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].testimony_text }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[0].key_achievements }}\n\n#### Testimony 2  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].testimony_id }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].recommender_name }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].recommender_company }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].recommender_role }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].collaboration_period }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].applicant_role }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].testimony_text }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[1].key_achievements }}\n\n#### Testimony 3  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].testimony_id }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].recommender_name }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].recommender_company }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].recommender_role }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].collaboration_period }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].applicant_role }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].testimony_text }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[2].key_achievements }}\n\n#### Testimony 4  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].testimony_id }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].recommender_name }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].recommender_company }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].recommender_role }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].collaboration_period }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].applicant_role }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].testimony_text }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[3].key_achievements }}\n\n#### Testimony 5  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].testimony_id }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].recommender_name }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].recommender_company }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].recommender_role }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].collaboration_period }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].applicant_role }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].testimony_text }}  \n{{ $('Limpando e Organizando Inputs1').item.json.output.testimonies[4].key_achievements }}\n\n---\n\n# INTELLIGENT DESIGN LOGIC\n\nYour goal is to create **5 distinct author personas** that feel like real human professionals with different writing styles, formatting preferences, and communication approaches.\n\n### Step 1: Analyze Each Recommender's Profile\n\nFor each testimony, consider:\n- **Recommender's role and seniority**: Senior executives write differently than mid-level managers\n- **Industry and company culture**: Tech startups vs. traditional manufacturing vs. academia\n- **Collaboration context**: Direct supervisor vs. client vs. peer vs. mentor\n- **Key achievements mentioned**: Technical depth vs. leadership vs. innovation vs. results\n\n### Step 2: Assign Distinct Author Personas\n\nCreate 5 different \"author personalities\" based on the recommenders. Think about how each person would naturally write:\n\n**Persona Type Examples** (choose what fits each recommender, don't use these labels in output):\n- **The Executive**: Concise, metric-driven, bullet points, emphasis on ROI and strategic impact\n- **The Technical Expert**: Detailed, analytical, uses specific terminology, longer explanations\n- **The Mentor**: Warm, narrative-driven, tells stories, emphasizes growth and potential\n- **The Data Analyst**: Structured, uses tables/charts, comparative analysis, evidence-based\n- **The Academic**: Formal, theoretical frameworks, comprehensive, well-referenced\n\n### Step 3: Ensure Maximum Differentiation\n\nMake sure the 5 personas differ in:\n- **Sentence structure**: Some use short punchy sentences, others use longer analytical ones\n- **Paragraph length**: Vary from 3-4 sentences to 5-6 sentences\n- **Formatting preferences**: Some love bold metrics, others prefer italics for emphasis, others use minimal formatting\n- **Visual elements**: Some use lists, others use tables, others use pull quotes\n- **Tone**: Formal vs. conversational, technical vs. accessible, warm vs. professional\n\n**CRITICAL**: Do NOT use color schemes, fonts, or HTML/CSS parameters. Focus on **writing style, tone, structure, and Markdown formatting** that humans would naturally use.\n\n---\n\n# GENERATION PARAMETERS\n\nFor each of the five design structures (T1–T5), generate an object with these fields:\n\n**REQUIRED FIELDS**:\n\n```json\n{\n  \"template_id\": \"T1\" | \"T2\" | \"T3\" | \"T4\" | \"T5\",\n  \"assigned_recommender\": \"[Full name from testimony]\",\n  \"tone_instructions\": \"Describe how this person writes. Examples:\n    - 'Senior executive style: concise sentences (12-15 words), metric-first paragraphs, uses bold for all numbers, minimal adjectives, direct and authoritative tone'\n    - 'Technical expert style: detailed explanations (20-25 words per sentence), uses technical terminology naturally, prefers italics for key concepts, analytical and precise tone'\n    - 'Mentor style: warm and narrative (15-20 words per sentence), tells stories chronologically, uses quotes and anecdotes, encouraging and personal tone'\n    - 'Data analyst style: structured and comparative (15-18 words per sentence), uses tables and lists frequently, evidence-based arguments, objective and measured tone'\n    - 'Academic style: formal and comprehensive (18-22 words per sentence), uses frameworks and references, minimal formatting, scholarly and thorough tone'\",\n  \n  \"narrative_framework\": \"How this person structures their argument. Examples:\n    - 'Metric-first: Start each section with the result/number, then explain the context and method'\n    - 'Chronological story: Begin with how we met, progress through collaboration, end with future potential'\n    - 'Problem-solution-impact: Present the challenge, describe the approach, quantify the outcome'\n    - 'Thematic: Organize by competency areas (leadership, technical skills, innovation) rather than timeline'\n    - 'Comparative analysis: Benchmark against industry standards, show how applicant exceeds norms'\",\n  \n  \"paragraph_structure\": \"How this person formats paragraphs. Examples:\n    - '3-4 short sentences per paragraph, double line breaks, each paragraph covers one idea'\n    - '5-6 medium sentences per paragraph, single line breaks, paragraphs flow into each other'\n    - 'Mix of short (2-3 sentences) and long (5-6 sentences) paragraphs for rhythm variation'\n    - 'Very structured: topic sentence + 3 supporting sentences + concluding sentence'\",\n  \n  \"sentence_style\": \"How this person constructs sentences. Examples:\n    - 'Short and punchy: 10-15 words, active voice, one idea per sentence'\n    - 'Medium analytical: 15-20 words, mix of simple and complex structures'\n    - 'Long and comprehensive: 20-25 words, uses clauses and qualifiers'\n    - 'Varied rhythm: alternates between short (10-12) and long (20-25) sentences'\",\n  \n  \"emphasis_style\": \"How this person emphasizes key information. Examples:\n    - 'Bold all metrics and numbers (e.g., **US$ 7B**, **300+ dashboards**)'\n    - 'Italicize technical terms and key concepts (e.g., *Business Intelligence*, *strategic leadership*)'\n    - 'Use ALL CAPS for critical achievements (e.g., INCREASED SALES BY 100%)'\n    - 'Minimal formatting: let the content speak for itself, only bold section headers'\n    - 'Mixed: bold for metrics, italics for skills, quotes for testimonials'\",\n  \n  \"visual_elements\": \"What visual elements this person prefers. Examples:\n    - 'Frequent bulleted lists for achievements and responsibilities'\n    - 'Numbered lists for sequential processes or ranked items'\n    - 'Tables for comparing before/after or multiple projects'\n    - 'Pull quotes (blockquotes) for highlighting key statements'\n    - 'Minimal: pure paragraph text with occasional subheadings'\n    - 'Sidebar boxes with summary statistics or key facts'\",\n  \n  \"readability_target\": \"How complex this person's writing is:\n    - 'Executive brief: 10th-11th grade, accessible and scannable'\n    - 'Professional standard: 11th-12th grade, balanced complexity'\n    - 'Technical depth: College level, assumes domain knowledge'\n    - 'Academic formal: Graduate level, comprehensive and precise'\",\n  \n  \"word_count_target\": \"Total length for this letter:\n    - Range: 1800-2500 words (full 5-block letter)\n    - Distribute across blocks based on narrative framework\",\n  \n  \"unique_trait\": \"One distinctive feature that makes this letter stand out. Examples:\n    - 'Opens each major section with a relevant industry statistic or benchmark'\n    - 'Includes a timeline graphic showing collaboration milestones'\n    - 'Uses a recurring metaphor (e.g., building, navigation, transformation)'\n    - 'Ends each section with a forward-looking statement about future impact'\n    - 'Incorporates brief case study boxes within the narrative'\n    - 'Uses a Q&A format for one section to add variety'\"\n}\n```\n\n**ORDERING REQUIREMENT**:\n- T1 MUST correspond to Testimony 1 (testimonies[0])\n- T2 MUST correspond to Testimony 2 (testimonies[1])\n- T3 MUST correspond to Testimony 3 (testimonies[2])\n- T4 MUST correspond to Testimony 4 (testimonies[3])\n- T5 MUST correspond to Testimony 5 (testimonies[4])\n\nDo NOT shuffle or reorder. The downstream nodes expect this exact sequence.\n\n---\n\n# OUTPUT FORMAT\n\nReturn ONLY valid JSON with this structure:\n\n```json\n{\n  \"petitioner_name\": \"[Name from input]\",\n  \"design_structures\": [\n    {\n      \"template_id\": \"T1\",\n      \"assigned_recommender\": \"[Testimony 1 recommender name]\",\n      \"tone_instructions\": \"[Detailed description of writing style]\",\n      \"narrative_framework\": \"[How to structure the argument]\",\n      \"paragraph_structure\": \"[How to format paragraphs]\",\n      \"sentence_style\": \"[How to construct sentences]\",\n      \"emphasis_style\": \"[How to emphasize key info]\",\n      \"visual_elements\": \"[What visual elements to use]\",\n      \"readability_target\": \"[Complexity level]\",\n      \"word_count_target\": \"[Length range]\",\n      \"unique_trait\": \"[One distinctive feature]\"\n    },\n    {\n      \"template_id\": \"T2\",\n      \"assigned_recommender\": \"[Testimony 2 recommender name]\",\n      ...\n    },\n    {\n      \"template_id\": \"T3\",\n      \"assigned_recommender\": \"[Testimony 3 recommender name]\",\n      ...\n    },\n    {\n      \"template_id\": \"T4\",\n      \"assigned_recommender\": \"[Testimony 4 recommender name]\",\n      ...\n    },\n    {\n      \"template_id\": \"T5\",\n      \"assigned_recommender\": \"[Testimony 5 recommender name]\",\n      ...\n    }\n  ]\n}\n```\n\n**VALIDATION CHECKLIST**:\n- ✅ Exactly 5 design structures (T1-T5)\n- ✅ Each has a unique tone_instructions (no duplicates)\n- ✅ Each has a different narrative_framework\n- ✅ Each has different emphasis_style and visual_elements\n- ✅ Order matches testimonies exactly (T1=testimonies[0], T2=testimonies[1], etc.)\n- ✅ No mention of colors, fonts, or HTML/CSS\n- ✅ Focus on human writing style and Markdown formatting\n\nDo NOT include code fences, markdown formatting, or explanations. Return ONLY the JSON object.\n",
        "hasOutputParser": true,
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -11424,
        288
      ],
      "id": "41e1a037-29dd-4f26-8a5e-828738115df5",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"required\": [\"petitioner_name\", \"design_structures\"],\n  \"properties\": {\n    \"petitioner_name\": { \"type\": \"string\" },\n    \"design_structures\": {\n      \"type\": \"array\",\n      \"minItems\": 5,\n      \"maxItems\": 5,\n      \"items\": {\n        \"type\": \"object\",\n        \"required\": [\n          \"template_id\",\n          \"assigned_recommender\",\n          \"tone_variable\",\n          \"layout_pattern\",\n          \"font_primary\",\n          \"font_secondary\",\n          \"color_primary_hsl_range\",\n          \"color_accent\",\n          \"layout_density\",\n          \"line_height\",\n          \"readability_target\",\n          \"paragraph_density_rule\",\n          \"semantic_elements\",\n          \"emphasis_pattern\",\n          \"narrative_framework\",\n          \"header_alignment\",\n          \"footer_style\",\n          \"contrast_mode\",\n          \"whitespace_profile\",\n          \"structure_features\",\n          \"tone_instructions\",\n          \"bonus_trait\"\n        ],\n        \"properties\": {\n          \"template_id\": { \"type\": \"string\" },\n          \"assigned_recommender\": { \"type\": \"string\" },\n          \"tone_variable\": { \"type\": \"string\" },\n          \"layout_pattern\": { \"type\": \"string\" },\n          \"font_primary\": { \"type\": \"string\" },\n          \"font_secondary\": { \"type\": \"string\" },\n          \"color_primary_hsl_range\": { \"type\": \"string\" },\n          \"color_accent\": { \"type\": \"string\" },\n          \"layout_density\": { \"type\": \"string\" },\n          \"line_height\": { \"type\": \"number\" },\n          \"readability_target\": { \"type\": \"string\" },\n          \"paragraph_density_rule\": { \"type\": \"string\" },\n          \"semantic_elements\": {\n            \"type\": \"array\",\n            \"minItems\": 2,\n            \"items\": { \"type\": \"string\" }\n          },\n          \"emphasis_pattern\": { \"type\": \"string\" },\n          \"narrative_framework\": { \"type\": \"string\" },\n          \"header_alignment\": { \"type\": \"string\" },\n          \"footer_style\": { \"type\": \"string\" },\n          \"contrast_mode\": { \"type\": \"string\" },\n          \"whitespace_profile\": { \"type\": \"string\" },\n          \"structure_features\": { \"type\": \"string\" },\n          \"tone_instructions\": { \"type\": \"string\" },\n          \"bonus_trait\": { \"type\": \"string\" }\n        }\n      }\n    }\n  }\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -11424,
        464
      ],
      "id": "451a3ebb-728b-4612-803d-20f9d8baa4fd",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -11584,
        496
      ],
      "id": "ff5b5f28-a4c0-4ccf-acf9-979e6b87f2ba",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -11376,
        688
      ],
      "id": "ca6cd56b-7c7e-4d36-979e-512e00e9b98d",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "BM9GfMk2VfLbt2ci",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "Resultado",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1vhMvfn4JBuizE_JIW7pw0pWDaB8s-YKD",
          "mode": "list",
          "cachedResultName": "Resultado",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1vhMvfn4JBuizE_JIW7pw0pWDaB8s-YKD"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        6496,
        208
      ],
      "id": "0214f22e-4234-4609-90f4-4813467a03c7",
      "name": "Create folder",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "J9wIimFY6ZhseHVL",
          "name": "Google Drive account 3"
        }
      }
    },
    {
      "parameters": {
        "name": "Testemunho 3",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Create folder').item.json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        8832,
        592
      ],
      "id": "052f5247-8b8a-4a51-b639-b77f7e82fa1b",
      "name": "Testemunho 3",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "J9wIimFY6ZhseHVL",
          "name": "Google Drive account 3"
        }
      }
    },
    {
      "parameters": {
        "inputDataFieldName": "data8",
        "name": "Testemunho 5",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Create folder').item.json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        8832,
        272
      ],
      "id": "d94fa9c1-bc5d-4797-a474-6f2a804f45e9",
      "name": "Testemunho 5",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "J9wIimFY6ZhseHVL",
          "name": "Google Drive account 3"
        }
      }
    },
    {
      "parameters": {
        "name": "=testemunho4 ",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Create folder').item.json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        8832,
        432
      ],
      "id": "062b1644-b55c-41db-b823-54ba4524b013",
      "name": "Testemunho 4",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "J9wIimFY6ZhseHVL",
          "name": "Google Drive account 3"
        }
      }
    },
    {
      "parameters": {
        "inputDataFieldName": "=data 6",
        "name": "=Testemunho 2",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Create folder').item.json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        8832,
        752
      ],
      "id": "5e2b11c9-ca75-4488-a751-5e009abb79d5",
      "name": "Testemunho 2",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "J9wIimFY6ZhseHVL",
          "name": "Google Drive account 3"
        }
      }
    },
    {
      "parameters": {
        "name": "=Testemunho 1",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Create folder').item.json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        8832,
        912
      ],
      "id": "f992f7dd-591b-4cf7-aa56-88945ddf72bd",
      "name": "Testemunho 1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "J9wIimFY6ZhseHVL",
          "name": "Google Drive account 3"
        }
      }
    },
    {
      "parameters": {
        "operation": "URL/HTML to PDF",
        "convertType": "htmlToPDF",
        "html": "={{ $('AI Agent2').item.json.output }}",
        "advancedOptions": {}
      },
      "type": "n8n-nodes-pdfco.PDFco Api",
      "typeVersion": 1,
      "position": [
        5776,
        256
      ],
      "id": "a3693243-7fbd-4a28-aa4d-3dc7f73e6fb8",
      "name": "PDFco Api8",
      "credentials": {
        "pdfcoApi": {
          "id": "JlTTI5hYRnMh18Q2",
          "name": "PDF.co account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "numberInputs": 9,
        "options": {
          "includeUnpaired": true
        }
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -11728,
        1520
      ],
      "id": "b2f1197a-0a2c-4354-8960-3fe1b62cafd0",
      "name": "Merge2",
      "onError": "continueRegularOutput"
    }
  ],
  "pinData": {
    "On form submission1": [
      {
        "json": {
          "Quadro Preenchido por Cliente": [
            {
              "filename": "Quadro de Informações_Cartas de Recomendação Preenchido.docx.pdf",
              "mimetype": "application/pdf",
              "size": 371716
            }
          ],
          "Testimonial 1 (CV/LinkedIn Testimonial": [
            {
              "filename": "CV_Bruno Barreira.pdf",
              "mimetype": "application/pdf",
              "size": 57839
            }
          ],
          "Testimonial 2 (CV/LinkedIn)": [
            {
              "filename": "CV_Cássio Laet.pdf",
              "mimetype": "application/pdf",
              "size": 61903
            }
          ],
          "Testimonial 3 (CV/LinkedIn)": [
            {
              "filename": "CV_Felipe Casanova.pdf",
              "mimetype": "application/pdf",
              "size": 30462
            }
          ],
          "Testimonial 4 (CV/LinkedIn)": [
            {
              "filename": "CV_Ivan Cascardi.pdf",
              "mimetype": "application/pdf",
              "size": 91029
            }
          ],
          "Testimonial 5 (CV/LinkedIn)": [
            {
              "filename": "Profile_Eliezer Filipov.pdf",
              "mimetype": "application/pdf",
              "size": 32985
            }
          ],
          "Estrategia Base": [
            {
              "filename": "Estratégia Ikaro.pdf",
              "mimetype": "application/pdf",
              "size": 94822
            }
          ],
          "PDF do OneNote escolhido por cliente": [
            {
              "filename": "17-3026.00 - Industrial Engineering Technologists and Technicians.pdf",
              "mimetype": "application/pdf",
              "size": 505199
            }
          ],
          "Background (CV) Petitcionario": [
            {
              "filename": "V3_resume_ikaro ferreira.pdf",
              "mimetype": "application/pdf",
              "size": 19071789
            }
          ],
          "Email": "paulorenatolimax@gmail.com",
          "submittedAt": "2025-10-15T19:09:57.568-04:00",
          "formMode": "test"
        },
        "binary": {
          "Quadro_Preenchido_por_Cliente": {
            "mimeType": "application/pdf",
            "fileType": "pdf",
            "fileExtension": "pdf",
            "data": "filesystem-v2",
            "fileName": "Quadro de Informações_Cartas de Recomendação Preenchido.docx.pdf",
            "id": "filesystem-v2:workflows/ByNmASs0333xFaPM/executions/temp/binary_data/bc4af111-7573-440c-8026-9aa3824a4b34",
            "fileSize": "372 kB"
          },
          "Testimonial_1__CV_LinkedIn_Testimonial": {
            "mimeType": "application/pdf",
            "fileType": "pdf",
            "fileExtension": "pdf",
            "data": "filesystem-v2",
            "fileName": "CV_Bruno Barreira.pdf",
            "id": "filesystem-v2:workflows/ByNmASs0333xFaPM/executions/temp/binary_data/e5bf11b9-d780-4e79-94f6-a57cee2fec7d",
            "fileSize": "57.8 kB"
          },
          "Testimonial_2__CV_LinkedIn_": {
            "mimeType": "application/pdf",
            "fileType": "pdf",
            "fileExtension": "pdf",
            "data": "filesystem-v2",
            "fileName": "CV_Cássio Laet.pdf",
            "id": "filesystem-v2:workflows/ByNmASs0333xFaPM/executions/temp/binary_data/52bfc171-e9a6-4c7a-9b98-7f257af77afc",
            "fileSize": "61.9 kB"
          },
          "Testimonial_3__CV_LinkedIn_": {
            "mimeType": "application/pdf",
            "fileType": "pdf",
            "fileExtension": "pdf",
            "data": "filesystem-v2",
            "fileName": "CV_Felipe Casanova.pdf",
            "id": "filesystem-v2:workflows/ByNmASs0333xFaPM/executions/temp/binary_data/76c574ab-e151-4ac3-84c7-f50756335c08",
            "fileSize": "30.5 kB"
          },
          "Testimonial_4__CV_LinkedIn_": {
            "mimeType": "application/pdf",
            "fileType": "pdf",
            "fileExtension": "pdf",
            "data": "filesystem-v2",
            "fileName": "CV_Ivan Cascardi.pdf",
            "id": "filesystem-v2:workflows/ByNmASs0333xFaPM/executions/temp/binary_data/dc59d86c-ecce-42a7-b429-b5cc07e1ea60",
            "fileSize": "91 kB"
          },
          "Testimonial_5__CV_LinkedIn_": {
            "mimeType": "application/pdf",
            "fileType": "pdf",
            "fileExtension": "pdf",
            "data": "filesystem-v2",
            "fileName": "Profile_Eliezer Filipov.pdf",
            "id": "filesystem-v2:workflows/ByNmASs0333xFaPM/executions/temp/binary_data/53a79c88-68bb-4427-ba1e-d81cf068f33a",
            "fileSize": "33 kB"
          },
          "Estrategia_Base": {
            "mimeType": "application/pdf",
            "fileType": "pdf",
            "fileExtension": "pdf",
            "data": "filesystem-v2",
            "fileName": "Estratégia Ikaro.pdf",
            "id": "filesystem-v2:workflows/ByNmASs0333xFaPM/executions/temp/binary_data/ab49ee7e-c924-4f45-b916-8ce9f8516b56",
            "fileSize": "94.8 kB"
          },
          "PDF_do_OneNote_escolhido_por_cliente": {
            "mimeType": "application/pdf",
            "fileType": "pdf",
            "fileExtension": "pdf",
            "data": "filesystem-v2",
            "fileName": "17-3026.00 - Industrial Engineering Technologists and Technicians.pdf",
            "id": "filesystem-v2:workflows/ByNmASs0333xFaPM/executions/temp/binary_data/190c7dbf-19c0-4afe-9160-2aa7dd2529dc",
            "fileSize": "505 kB"
          },
          "Background__CV__Petitcionario": {
            "mimeType": "application/pdf",
            "fileType": "pdf",
            "fileExtension": "pdf",
            "data": "filesystem-v2",
            "fileName": "V3_resume_ikaro ferreira.pdf",
            "id": "filesystem-v2:workflows/ByNmASs0333xFaPM/executions/temp/binary_data/79b70e06-9e7c-4d71-b394-0d5fe5eb4b80",
            "fileSize": "19.1 MB"
          }
        }
      }
    ]
  },
  "connections": {
    "On form submission1": {
      "main": [
        [
          {
            "node": "Resume 2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Resume",
            "type": "main",
            "index": 0
          },
          {
            "node": "Resume3",
            "type": "main",
            "index": 0
          },
          {
            "node": "Resume 6",
            "type": "main",
            "index": 0
          },
          {
            "node": "Quadro Preenchido do Cliente1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Resume Cliente1",
            "type": "main",
            "index": 0
          },
          {
            "node": "OneNote1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Resume 7",
            "type": "main",
            "index": 0
          },
          {
            "node": "Estrategia Base1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Quadro Preenchido do Cliente1": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Resume 6": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 7
          }
        ]
      ]
    },
    "Resume": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 5
          }
        ]
      ]
    },
    "Resume 2": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "Limpando e Organizando Inputs1": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Resume 7": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 8
          }
        ]
      ]
    },
    "Resume Cliente1": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Estrategia Base1": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "OneNote1": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [],
        [
          {
            "node": "Reports1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a document in Google Docs1": {
      "ai_tool": [
        [
          {
            "node": "Reports1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Send email in Send Email1": {
      "ai_tool": [
        [
          {
            "node": "Reports1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Reports1": {
      "main": [
        [
          {
            "node": "Stop and Error1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Limpando e Organizando Inputs1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "Limpando e Organizando Inputs1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "VECTOR STORE": {
      "ai_tool": [
        [
          {
            "node": "Basic LLM Chain6",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "BLOCO": {
      "main": [
        [
          {
            "node": "BLOCO6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BLOCO5": {
      "main": [
        [
          {
            "node": "BLOCO7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VECTOR STORE7": {
      "ai_tool": [
        [
          {
            "node": "Basic LLM Chain5",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "PDFco Api5": {
      "main": [
        [
          {
            "node": "PDFco Api6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BLOCO1.1": {
      "main": [
        [
          {
            "node": "BLOCO2.1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BLOCO4.1": {
      "main": [
        [
          {
            "node": "BLOCO5.1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BLOCO5.1": {
      "main": [
        [
          {
            "node": "Basic LLM Chain6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BLOC": {
      "main": [
        [
          {
            "node": "BLOCO4.1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PDFco Api6": {
      "main": [
        [
          {
            "node": "PDFco Api7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VECTOR STORE9": {
      "ai_tool": [
        []
      ]
    },
    "BLO": {
      "main": [
        [
          {
            "node": "BLO6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BLO6": {
      "main": [
        [
          {
            "node": "BLO9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BLO7": {
      "main": [
        [
          {
            "node": "BLO8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BLO8": {
      "main": [
        [
          {
            "node": "Basic LLM Chain7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PDFco Api7": {
      "main": [
        [
          {
            "node": "PDFco Api8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BL": {
      "main": [
        [
          {
            "node": "BL6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BL6": {
      "main": [
        [
          {
            "node": "BL7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BL7": {
      "main": [
        [
          {
            "node": "BL8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BL8": {
      "main": [
        [
          {
            "node": "BL9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VECTOR STORE13": {
      "ai_tool": [
        [
          {
            "node": "Basic LLM Chain7",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "B": {
      "main": [
        [
          {
            "node": "B6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "B6": {
      "main": [
        [
          {
            "node": "B7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "B7": {
      "main": [
        [
          {
            "node": "B8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "B8": {
      "main": [
        [
          {
            "node": "B9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "B9": {
      "main": [
        [
          {
            "node": "Basic LLM Chain8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VECTOR STORE14": {
      "ai_tool": [
        [
          {
            "node": "Basic LLM Chain8",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "PDFco Api9": {
      "main": [
        [
          {
            "node": "Send email1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send email1": {
      "main": [
        [
          {
            "node": "Create folder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BLOCO2.1": {
      "main": [
        [
          {
            "node": "BLOC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BLOCO6": {
      "main": [
        [
          {
            "node": "BLOCO5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BLOCO7": {
      "main": [
        [
          {
            "node": "BLOC6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DOWLOAD ": {
      "main": [
        [
          {
            "node": "DOWNLOAD 6",
            "type": "main",
            "index": 0
          },
          {
            "node": "Testemunho 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DOWNLOAD ": {
      "main": [
        [
          {
            "node": "DOWNLOAD 7",
            "type": "main",
            "index": 0
          },
          {
            "node": "Testemunho 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DOWNLOAD 6": {
      "main": [
        [
          {
            "node": "DOWNLOAD ",
            "type": "main",
            "index": 0
          },
          {
            "node": "Testemunho 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DOWNLOAD 7": {
      "main": [
        [
          {
            "node": "DOWNLOAD 8",
            "type": "main",
            "index": 0
          },
          {
            "node": "Testemunho 4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DOWNLOAD 8": {
      "main": [
        [
          {
            "node": "Testemunho 5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Message a model3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "HTML VECTOR6": {
      "ai_tool": [
        []
      ]
    },
    "Message a model3": {
      "main": [
        [
          {
            "node": "BLOCO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "Message a model4",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "HTML VECTOR7": {
      "ai_tool": [
        []
      ]
    },
    "Message a model4": {
      "main": [
        [
          {
            "node": "BLO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain5": {
      "main": [
        [
          {
            "node": "Message a model4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain6": {
      "main": [
        [
          {
            "node": "Message a model3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BLOC6": {
      "main": [
        [
          {
            "node": "Basic LLM Chain5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "Message a Model",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Message a Model": {
      "main": [
        [
          {
            "node": "BL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent2": {
      "main": [
        [
          {
            "node": "B",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model8": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "BLO9": {
      "main": [
        [
          {
            "node": "BLO7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent3": {
      "main": [
        [
          {
            "node": "PDFco Api5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model9": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain7": {
      "main": [
        [
          {
            "node": "Message a Model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain8": {
      "main": [
        [
          {
            "node": "AI Agent3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BL9": {
      "main": [
        [
          {
            "node": "Basic LLM Chain9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain9": {
      "main": [
        [
          {
            "node": "AI Agent2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model5": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML VECTOR8": {
      "ai_tool": [
        []
      ]
    },
    "HTML VECTOR9": {
      "ai_tool": [
        []
      ]
    },
    "Merge3": {
      "main": [
        [
          {
            "node": "Message a model6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Resume3": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 6
          }
        ]
      ]
    },
    "Message a model6": {
      "main": [
        [
          {
            "node": "Message a model7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model7": {
      "main": [
        [
          {
            "node": "Send email2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "BLOCO1.1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Create folder": {
      "main": [
        [
          {
            "node": "DOWLOAD ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Testemunho 3": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Testemunho 5": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Testemunho 4": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Testemunho 2": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "Testemunho 1": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "PDFco Api8": {
      "main": [
        [
          {
            "node": "PDFco Api9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Limpando e Organizando Inputs1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "4b603e49-96ae-4f2b-ae48-a202d5427435",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "61a277352ba408db8662a8149b1a5cf83059144bd22ba16285bd4ca98da453cc"
  },
  "id": "ByNmASs0333xFaPM",
  "tags": []
}